<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Jungle Words ğŸŒ¿ | Crabcake</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;800;900&display=swap"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --jungle-dark:  #0d2818;
      --jungle-mid:   #1a4a2e;
      --jungle-light: #2d6e47;
      --leaf:         #4CAF50;
      --leaf2:        #66BB6A;
      --gold:         #FFD54F;
      --gold2:        #FFA000;
      --coral:        #FF6B6B;
      --sky:          #81D4FA;
      --brown:        #795548;
      --tan:          #BCAAA4;
      --white:        #ffffff;
      --cream:        #FFF8E1;
    }

    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      background: var(--jungle-dark);
      font-family: 'Nunito', sans-serif;
      touch-action: manipulation;
    }

    /* â”€â”€ JUNGLE BACKGROUND â”€â”€ */
    .jungle-bg {
      position: fixed; inset: 0; z-index: 0; overflow: hidden;
      background: linear-gradient(180deg, #071a0f 0%, #0d2818 35%, #1a4a2e 70%, #0d2818 100%);
    }
    .jungle-bg::before {
      content: '';
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 600px 400px at 15% 40%, rgba(76,175,80,0.08) 0%, transparent 70%),
        radial-gradient(ellipse 500px 300px at 85% 60%, rgba(102,187,106,0.06) 0%, transparent 70%);
    }

    /* Animated vines */
    .vine {
      position: absolute;
      width: 3px;
      background: linear-gradient(180deg, transparent, #2d6e47, #1a4a2e);
      border-radius: 3px;
      transform-origin: top center;
      animation: vineSwing ease-in-out infinite;
      opacity: 0.6;
    }
    @keyframes vineSwing {
      0%,100% { transform: rotate(-8deg); }
      50%      { transform: rotate(8deg); }
    }

    /* Jungle floor */
    .jungle-floor {
      position: fixed; bottom: 0; left: 0; right: 0;
      height: 70px; z-index: 1; pointer-events: none;
      background: linear-gradient(180deg, transparent, rgba(13,40,24,0.9));
    }
    .jungle-floor::after {
      content: 'ğŸŒ¿ ğŸŒº ğŸ„ ğŸŒ¿ ğŸŒ¸ ğŸƒ ğŸŒ¿ ğŸŒº ğŸ„ ğŸŒ¸ ğŸŒ¿ ğŸƒ ğŸŒº ğŸŒ¿';
      position: absolute; bottom: 4px; left: 0; right: 0;
      text-align: center; font-size: 1.3rem; letter-spacing: 6px; opacity: 0.8;
    }

    /* Fireflies */
    .firefly {
      position: absolute;
      width: 4px; height: 4px;
      border-radius: 50%;
      background: #FFD54F;
      box-shadow: 0 0 6px 2px rgba(255,213,79,0.8);
      animation: fireflyFloat linear infinite;
      pointer-events: none;
    }
    @keyframes fireflyFloat {
      0%   { opacity: 0; transform: translate(0, 0); }
      20%  { opacity: 1; }
      80%  { opacity: 0.8; }
      100% { opacity: 0; transform: translate(var(--fx), var(--fy)); }
    }

    /* â”€â”€ SCREENS â”€â”€ */
    .screen {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 10; padding: 1.5rem;
      transition: opacity 0.35s, transform 0.35s;
    }
    .screen.hidden {
      opacity: 0; pointer-events: none;
      touch-action: none; display: none;
    }

    /* â”€â”€ START SCREEN â”€â”€ */
    #startScreen { gap: 0; }

    .game-icon {
      font-size: 5rem;
      animation: iconBob 2.5s ease-in-out infinite;
      filter: drop-shadow(0 8px 20px rgba(76,175,80,0.4));
      margin-bottom: 0.5rem;
    }
    @keyframes iconBob {
      0%,100% { transform: translateY(0) rotate(-5deg); }
      50%      { transform: translateY(-12px) rotate(5deg); }
    }

    .game-title {
      font-family: 'Fredoka One', cursive;
      font-size: clamp(3rem, 9vw, 5.5rem);
      color: var(--gold);
      text-shadow: 3px 3px 0 rgba(0,0,0,0.4), 0 0 40px rgba(255,213,79,0.3);
      text-align: center;
      line-height: 1;
      margin-bottom: 0.3rem;
    }
    .game-subtitle {
      font-size: clamp(0.75rem, 2.2vw, 0.95rem);
      font-weight: 900;
      color: var(--leaf2);
      letter-spacing: 3px;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .age-select-label {
      font-size: 0.75rem; font-weight: 900;
      color: rgba(255,255,255,0.45);
      letter-spacing: 2px; text-transform: uppercase;
      text-align: center; margin-bottom: 0.9rem;
    }
    .age-buttons { display: flex; gap: 0.9rem; flex-wrap: wrap; justify-content: center; margin-bottom: 2rem; }
    .age-btn {
      padding: 0.9rem 1.4rem;
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      font-family: 'Nunito', sans-serif; font-weight: 900;
      cursor: pointer; background: rgba(255,255,255,0.05);
      color: white; min-width: 105px;
      display: flex; flex-direction: column; align-items: center; gap: 3px;
      transition: all 0.2s;
    }
    .age-btn .age-emoji { font-size: 1.5rem; }
    .age-btn .age-label { font-size: 0.85rem; }
    .age-btn .age-topic { font-size: 0.62rem; opacity: 0.65; text-align: center; }
    .age-btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.1); }
    .age-btn[data-age="5"].selected  { border-color: var(--leaf);  background: rgba(76,175,80,0.2); }
    .age-btn[data-age="7"].selected  { border-color: var(--gold);  background: rgba(255,213,79,0.15); }
    .age-btn[data-age="9"].selected  { border-color: var(--coral); background: rgba(255,107,107,0.15); }

    .start-btn {
      padding: 1rem 3rem;
      background: linear-gradient(135deg, var(--leaf), #388E3C);
      color: white;
      border: none; border-radius: 50px;
      font-family: 'Fredoka One', cursive; font-size: 1.8rem;
      cursor: pointer;
      box-shadow: 0 6px 0 #1B5E20, 0 8px 24px rgba(76,175,80,0.35);
      transition: all 0.15s; opacity: 0.4; pointer-events: none;
    }
    .start-btn.ready { opacity: 1; pointer-events: all; }
    .start-btn.ready:hover  { transform: translateY(-3px); box-shadow: 0 9px 0 #1B5E20, 0 12px 28px rgba(76,175,80,0.45); }
    .start-btn.ready:active { transform: translateY(2px);  box-shadow: 0 3px 0 #1B5E20; }

    /* â”€â”€ HUD â”€â”€ */
    #hud {
      position: fixed; top: 0; left: 0; right: 0; z-index: 20;
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.7rem 1.2rem;
      background: rgba(7,26,15,0.88);
      backdrop-filter: blur(8px);
      border-bottom: 2px solid rgba(76,175,80,0.35);
    }
    #hud.hidden { display: none; }
    .hud-item { display: flex; flex-direction: column; align-items: center; gap: 1px; }
    .hud-label { font-size: 0.52rem; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,0.4); }
    .hud-value { font-family: 'Fredoka One', cursive; font-size: 1.7rem; color: var(--gold); line-height: 1; }

    .hud-btn {
      display: flex; flex-direction: column; align-items: center; gap: 2px;
      background: rgba(255,255,255,0.07); border: 2px solid rgba(255,255,255,0.12);
      border-radius: 12px; padding: 0.3rem 0.7rem;
      cursor: pointer; transition: all 0.15s; text-decoration: none;
    }
    .hud-btn:hover { background: rgba(255,255,255,0.14); transform: translateY(-2px); }
    .hud-btn-icon  { font-size: 1.2rem; line-height: 1; }
    .hud-btn-label { font-size: 0.5rem; font-weight: 900; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(255,255,255,0.4); }

    /* Lives */
    .lives-display { display: flex; gap: 4px; align-items: center; }
    .life-heart { font-size: 1.4rem; transition: transform 0.2s; }
    .life-heart.lost { filter: grayscale(1) opacity(0.3); transform: scale(0.8); }

    /* Sentence counter */
    #sentenceVal { color: var(--leaf2); }

    /* â”€â”€ GAME AREA â”€â”€ */
    #gameArea {
      position: fixed; inset: 0; z-index: 5;
      display: flex; flex-direction: column;
      align-items: center;
      padding-top: 80px; padding-bottom: 80px;
      gap: 1rem;
    }
    #gameArea.hidden { display: none; }

    /* Build zone â€” where tapped words go */
    .build-zone {
      width: 100%; max-width: 600px;
      min-height: 64px;
      background: rgba(255,248,225,0.06);
      border: 2px dashed rgba(255,213,79,0.3);
      border-radius: 20px;
      padding: 0.8rem 1rem;
      display: flex; flex-wrap: wrap; gap: 8px;
      align-items: center; justify-content: center;
    }
    .build-zone-label {
      font-size: 0.6rem; font-weight: 900; letter-spacing: 2px;
      text-transform: uppercase; color: rgba(255,213,79,0.4);
      text-align: center; margin-bottom: 4px;
      width: 100%;
    }
    .built-word {
      padding: 0.45rem 1rem;
      background: linear-gradient(135deg, rgba(255,213,79,0.2), rgba(255,160,0,0.15));
      border: 2px solid rgba(255,213,79,0.5);
      border-radius: 50px;
      font-family: 'Fredoka One', cursive;
      font-size: clamp(1rem, 3.5vw, 1.3rem);
      color: var(--gold);
      animation: wordPlop 0.25s cubic-bezier(0.34,1.56,0.64,1);
    }
    @keyframes wordPlop {
      0%   { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .built-word.correct-flash {
      background: linear-gradient(135deg, rgba(76,175,80,0.4), rgba(56,142,60,0.3));
      border-color: var(--leaf2);
      color: #C8E6C9;
    }
    .built-word.wrong-shake {
      animation: wrongShake 0.4s ease-out;
      border-color: var(--coral);
      background: rgba(255,107,107,0.2);
    }
    @keyframes wrongShake {
      0%,100% { transform: translateX(0); }
      20%     { transform: translateX(-8px); }
      40%     { transform: translateX(8px); }
      60%     { transform: translateX(-6px); }
      80%     { transform: translateX(6px); }
    }

    /* Word pool â€” the scrambled words to tap */
    .word-pool {
      width: 100%; max-width: 600px;
      display: flex; flex-wrap: wrap; gap: 10px;
      justify-content: center; align-items: center;
      padding: 0.5rem;
    }
    .word-tile {
      padding: 0.7rem 1.2rem;
      background: linear-gradient(135deg, var(--jungle-light), var(--jungle-mid));
      border: 3px solid rgba(76,175,80,0.5);
      border-radius: 14px;
      font-family: 'Fredoka One', cursive;
      font-size: clamp(1.1rem, 4vw, 1.5rem);
      color: var(--cream);
      cursor: pointer;
      transition: all 0.15s;
      box-shadow: 0 4px 0 rgba(0,0,0,0.3), 0 6px 14px rgba(0,0,0,0.2);
      user-select: none; -webkit-user-select: none;
    }
    .word-tile:hover  { transform: translateY(-3px); border-color: var(--leaf2); background: linear-gradient(135deg, #3a8a52, #2d6e47); }
    .word-tile:active { transform: translateY(1px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
    .word-tile.used   { opacity: 0.25; pointer-events: none; transform: scale(0.9); }

    /* Hint */
    .hint-area {
      font-size: clamp(0.75rem, 2.5vw, 0.9rem);
      font-weight: 800;
      color: rgba(255,255,255,0.35);
      text-align: center;
      font-style: italic;
      padding: 0 1rem;
    }

    /* Progress dots */
    .progress-dots {
      display: flex; gap: 6px; justify-content: center;
    }
    .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: rgba(255,255,255,0.15);
      transition: background 0.3s, transform 0.3s;
    }
    .dot.done    { background: var(--leaf2); transform: scale(1.2); }
    .dot.current { background: var(--gold); transform: scale(1.3); box-shadow: 0 0 8px rgba(255,213,79,0.5); }

    /* â”€â”€ CHARACTER â”€â”€ */
    .character-wrap {
      position: relative;
      display: flex; flex-direction: column; align-items: center;
      z-index: 25;
    }
    .character {
      font-size: clamp(3.5rem, 10vw, 5rem);
      line-height: 1;
      transition: transform 0.2s;
    }
    .character.dance {
      animation: danceMoves 0.8s ease-in-out;
    }
    @keyframes danceMoves {
      0%   { transform: translateY(0) rotate(0deg) scale(1); }
      15%  { transform: translateY(-20px) rotate(-15deg) scale(1.1); }
      30%  { transform: translateY(-15px) rotate(15deg) scale(1.15); }
      45%  { transform: translateY(-25px) rotate(-10deg) scale(1.2); }
      60%  { transform: translateY(-18px) rotate(12deg) scale(1.15); }
      75%  { transform: translateY(-10px) rotate(-8deg) scale(1.1); }
      100% { transform: translateY(0) rotate(0deg) scale(1); }
    }
    .character.ouch {
      animation: ouchWiggle 0.4s ease-out;
    }
    @keyframes ouchWiggle {
      0%,100% { transform: rotate(0deg); }
      25%     { transform: rotate(-12deg) translateX(-5px); }
      75%     { transform: rotate(12deg)  translateX(5px); }
    }
    .speech-bubble {
      position: fixed;
      top: 75px;
      left: 50%;
      transform: translateX(-50%) scale(0.8) translateY(10px);
      background: white;
      color: var(--jungle-dark);
      border-radius: 16px;
      padding: 0.5rem 1.2rem;
      font-weight: 900;
      font-size: 1rem;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s, transform 0.2s;
      z-index: 50;
    }
    .speech-bubble::after {
      content: '';
      position: absolute;
      top: -8px; left: 50%; transform: translateX(-50%);
      border: 8px solid transparent;
      border-bottom-color: white;
      border-top: none;
    }
    .speech-bubble.show {
      opacity: 1;
      transform: translateX(-50%) scale(1) translateY(0);
    }

    /* â”€â”€ FEEDBACK FLASH â”€â”€ */
    .feedback-pop {
      position: fixed;
      font-family: 'Fredoka One', cursive;
      font-size: 2rem; pointer-events: none; z-index: 30;
      animation: feedbackAnim 0.9s ease-out forwards;
    }
    @keyframes feedbackAnim {
      0%   { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.4); }
    }
    .confetti-piece {
      position: fixed; border-radius: 2px;
      pointer-events: none; z-index: 35;
      animation: confettiFall linear forwards;
    }
    @keyframes confettiFall {
      0%   { opacity: 1; transform: translateY(0) rotate(0deg); }
      100% { opacity: 0; transform: translateY(200px) rotate(720deg); }
    }

    /* Flash overlay */
    .flash-overlay {
      position: fixed; inset: 0; z-index: 25; pointer-events: none;
      animation: flashFade 0.35s ease-out forwards;
    }
    @keyframes flashFade { 0% { opacity: 0.2; } 100% { opacity: 0; } }

    /* â”€â”€ COUNTDOWN â”€â”€ */
    #countdown {
      position: fixed; inset: 0; z-index: 40;
      display: flex; align-items: center; justify-content: center;
      background: rgba(7,26,15,0.75); backdrop-filter: blur(4px);
    }
    #countdown.hidden { display: none; }
    .countdown-num {
      font-family: 'Fredoka One', cursive;
      font-size: 12rem; color: var(--gold);
      text-shadow: 0 0 60px rgba(255,213,79,0.5);
      animation: countPop 0.8s ease-out;
    }
    @keyframes countPop {
      0%   { transform: scale(2); opacity: 0; }
      40%  { transform: scale(0.9); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* â”€â”€ END SCREEN â”€â”€ */
    #endScreen { gap: 1rem; }
    .end-rating { font-size: 3rem; text-align: center; }
    .end-title {
      font-family: 'Fredoka One', cursive;
      font-size: clamp(2rem, 7vw, 3.5rem);
      color: var(--gold);
      text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
      text-align: center;
    }
    .end-score-box {
      background: rgba(255,255,255,0.06);
      border: 2px solid rgba(76,175,80,0.35);
      border-radius: 24px;
      padding: 1.2rem 2.5rem;
      text-align: center;
    }
    .end-score-label { font-size: 0.65rem; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; color: var(--leaf2); margin-bottom: 0.3rem; }
    .end-score-num   { font-family: 'Fredoka One', cursive; font-size: 4rem; color: var(--gold); line-height: 1; }
    .end-score-sub   { font-size: 0.8rem; font-weight: 700; color: rgba(255,255,255,0.5); margin-top: 0.3rem; }
    .end-message     { font-size: 1rem; font-weight: 800; color: rgba(255,255,255,0.8); text-align: center; max-width: 320px; }
    .end-buttons     { display: flex; gap: 0.9rem; flex-wrap: wrap; justify-content: center; }
    .end-btn {
      padding: 0.8rem 1.8rem; border: none; border-radius: 50px;
      font-family: 'Fredoka One', cursive; font-size: 1.4rem;
      cursor: pointer; transition: all 0.15s;
      box-shadow: 0 4px 0 rgba(0,0,0,0.3);
    }
    .end-btn:hover  { transform: translateY(-2px); }
    .end-btn:active { transform: translateY(1px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
    .btn-play-again   { background: var(--leaf); color: white; }
    .btn-change-level { background: rgba(255,255,255,0.1); color: white; border: 2px solid rgba(255,255,255,0.2); }
    .btn-home         { background: rgba(255,255,255,0.1); color: white; border: 2px solid rgba(255,255,255,0.2); text-decoration: none; display: inline-flex; align-items: center; }

    .back-link {
      position: fixed; top: 1rem; left: 1rem; z-index: 50;
      color: rgba(255,255,255,0.35); font-size: 0.8rem; font-weight: 900;
      letter-spacing: 1px; text-decoration: none; text-transform: uppercase;
      transition: color 0.2s;
    }
    .back-link:hover { color: var(--leaf2); }
  /* â”€â”€ BADGE SYSTEM â”€â”€ */
  .badge-toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(80px);background:linear-gradient(135deg,#0d2818,#1a4a2e);border:2px solid #ffd700;border-radius:20px;padding:14px 22px;display:flex;align-items:center;gap:14px;z-index:9999;box-shadow:0 8px 32px rgba(0,0,0,.5),0 0 24px rgba(255,215,0,.3);transition:transform .5s cubic-bezier(.34,1.56,.64,1),opacity .4s;opacity:0;pointer-events:none;max-width:340px;}
  .badge-toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
  .badge-toast-em{font-size:2.4rem;flex-shrink:0;filter:drop-shadow(0 0 8px rgba(255,215,0,.8));animation:badgePop .6s cubic-bezier(.34,1.56,.64,1);}
  @keyframes badgePop{0%{transform:scale(0) rotate(-20deg)}60%{transform:scale(1.3) rotate(5deg)}100%{transform:scale(1) rotate(0)}}
  .badge-toast-text{display:flex;flex-direction:column;gap:2px;}
  .badge-toast-label{font-size:.62rem;text-transform:uppercase;letter-spacing:2px;color:#ffd700;font-weight:bold;}
  .badge-toast-name{font-size:1.05rem;color:#fff;font-weight:bold;}
  .badge-toast-desc{font-size:.72rem;color:#a8ff80;}
  .badges-earned-row{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin:14px 0 4px;}
  .badge-coin{display:flex;flex-direction:column;align-items:center;gap:4px;position:relative;}
  .badge-coin-em{width:56px;height:56px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.8rem;border:3px solid #ffd700;background:radial-gradient(circle at 35% 30%,#fff9e6,#ffd700 60%,#b8860b);box-shadow:0 0 16px rgba(255,215,0,.5),inset 0 2px 4px rgba(255,255,255,.4);animation:coinShimmer 2s ease-in-out infinite alternate;}
  @keyframes coinShimmer{from{box-shadow:0 0 10px rgba(255,215,0,.4)}to{box-shadow:0 0 24px rgba(255,215,0,.8),0 0 40px rgba(255,215,0,.3)}}
  .badge-coin-name{font-size:.6rem;color:#ffd700;text-align:center;max-width:60px;line-height:1.2;}
  .badge-coin.new-badge .badge-coin-em::after{content:'NEW!';position:absolute;top:-6px;right:-6px;background:#ff4444;color:#fff;font-size:.45rem;font-weight:bold;padding:2px 5px;border-radius:6px;letter-spacing:.5px;}
  .badges-section-title{font-size:.75rem;text-transform:uppercase;letter-spacing:2px;color:#a8ff80;text-align:center;margin-bottom:8px;}
  .end-badges-wrap{margin:10px 0;padding:12px;background:rgba(57,255,20,.07);border:1px solid rgba(57,255,20,.2);border-radius:14px;}
  /* â”€â”€ FEEDBACK STRIP â”€â”€ */
  .feedback-strip{margin-top:18px;padding:12px 16px;background:rgba(57,255,20,.05);border:1px solid rgba(57,255,20,.15);border-radius:14px;text-align:center;}
  .feedback-text{font-size:.78rem;color:rgba(255,255,255,.55);margin-bottom:10px;}
  .feedback-btns{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;}
  .feedback-btn{font-size:.7rem;padding:7px 14px;border-radius:20px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.06);color:rgba(255,255,255,.7);text-decoration:none;transition:all .2s;white-space:nowrap;}
  .feedback-btn:hover{background:rgba(255,255,255,.12);border-color:rgba(255,255,255,.4);color:#fff;}
  .feedback-claim{display:none;margin-top:10px;}
  .feedback-claim-btn{font-size:.72rem;padding:8px 18px;border-radius:20px;border:none;background:linear-gradient(135deg,#ffd700,#ff8800);color:#1a0a2e;font-weight:bold;cursor:pointer;transition:all .2s;animation:claimPop .4s cubic-bezier(.34,1.56,.64,1);}
  @keyframes claimPop{from{transform:scale(0);opacity:0}to{transform:scale(1);opacity:1}}
  .feedback-claim-btn:hover{transform:scale(1.06);box-shadow:0 4px 16px rgba(255,215,0,.4);}
  .feedback-claim-btn:disabled{opacity:.5;cursor:default;transform:none;background:#555;}
  </style>
</head>
<body>

  <div class="jungle-bg" id="jungleBg"></div>
  <div class="jungle-floor"></div>
  <a href="index.html" class="back-link" id="backLink">â† Back</a>

  <!-- START SCREEN -->
  <div class="screen" id="startScreen">
    <div class="game-icon">ğŸ¦</div>
    <div class="game-title">Jungle Words!</div>
    <div class="game-subtitle">Crabcake Â· Educational Games</div>

    <div class="age-select-label">Choose your explorer</div>
    <div class="age-buttons">
      <button class="age-btn" data-age="5" onclick="selectAge(5)">
        <span class="age-emoji">ğŸŸ¢</span>
        <span class="age-label">Ages 5â€“6</span>
        <span class="age-topic">2â€“3 word<br>sentences</span>
      </button>
      <button class="age-btn" data-age="7" onclick="selectAge(7)">
        <span class="age-emoji">ğŸŸ¡</span>
        <span class="age-label">Ages 7â€“8</span>
        <span class="age-topic">4â€“5 word<br>sentences</span>
      </button>
      <button class="age-btn" data-age="9" onclick="selectAge(9)">
        <span class="age-emoji">ğŸ”´</span>
        <span class="age-label">Ages 9â€“10</span>
        <span class="age-topic">Longer sentences<br>with punctuation</span>
      </button>
    </div>
    <button class="start-btn" id="startBtn" onclick="startCountdown()">ğŸŒ¿ Explore!</button>
  </div>

  <!-- COUNTDOWN -->
  <div id="countdown" class="hidden">
    <div class="countdown-num" id="countdownNum">3</div>
  </div>

  <!-- HUD -->
  <div id="hud" class="hidden">
    <div class="hud-item">
      <div class="hud-label">Score</div>
      <div class="hud-value" id="scoreVal">0</div>
    </div>
    <button class="hud-btn" onclick="hudBack()" title="Level Select">
      <span class="hud-btn-icon">â†©ï¸</span>
      <span class="hud-btn-label">Levels</span>
    </button>
    <div class="hud-item">
      <div class="hud-label">Lives</div>
      <div class="lives-display" id="livesDisplay">
        <span class="life-heart" id="h1">â¤ï¸</span>
        <span class="life-heart" id="h2">â¤ï¸</span>
        <span class="life-heart" id="h3">â¤ï¸</span>
      </div>
    </div>
    <a class="hud-btn" href="index.html#games" title="Home">
      <span class="hud-btn-icon">ğŸ </span>
      <span class="hud-btn-label">Home</span>
    </a>
    <div class="hud-item">
      <div class="hud-label">Done</div>
      <div class="hud-value" id="sentenceVal">0</div>
    </div>
  </div>

  <!-- GAME AREA -->
  <div id="gameArea" class="hidden">
    <!-- Progress dots -->
    <div class="progress-dots" id="progressDots"></div>

    <!-- Character -->
    <div class="character-wrap">
      <div class="speech-bubble" id="speechBubble">Amazing! ğŸ‰</div>
      <div class="character" id="character">ğŸ¦</div>
    </div>

    <!-- Build zone -->
    <div>
      <div class="build-zone-label">Build the sentence</div>
      <div class="build-zone" id="buildZone"></div>
    </div>

    <!-- Hint -->
    <div class="hint-area" id="hintArea"></div>

    <!-- Word pool -->
    <div class="word-pool" id="wordPool"></div>
  </div>

  <!-- END SCREEN -->
  <div class="screen hidden" id="endScreen">
    <div class="end-rating" id="endRating">â­â­â­</div>
    <div class="end-title" id="endTitle">Jungle Master!</div>
    <div class="end-score-box">
      <div class="end-score-label">Sentences Built</div>
      <div class="end-score-num" id="endScoreNum">0</div>
      <div class="end-score-sub" id="endScoreSub">correct sentences</div>
    </div>
    <div class="end-message" id="endMessage">Great exploring!</div>
    <div class="end-badges-wrap" id="endBadgesWrap" style="display:none">
      <div class="badges-section-title">ğŸ† Badges Earned!</div>
      <div class="badges-earned-row" id="endBadgesRow"></div>
    </div>
    <div class="end-buttons">
      <button class="end-btn btn-play-again" onclick="playAgain()">ğŸŒ¿ Play Again!</button>
      <button class="end-btn btn-change-level" onclick="changeLevel()">Change Level</button>
      <a href="index.html" class="end-btn btn-home">ğŸ¦€ Home</a>
    </div>
    <div class="feedback-strip">
      <p class="feedback-text">ğŸ’Œ Found a bug or have a game idea?</p>
      <div class="feedback-btns">
        <a class="feedback-btn" href="mailto:hello@crabcake.kids?subject=Bug%20Report%20%E2%80%93%20Jungle%20Words&body=Hi!%20I%20found%20a%20bug%20in%20Jungle%20Words%3A%0A%0A" onclick="showClaim('bug')">ğŸ› Report a Bug</a>
        <a class="feedback-btn" href="mailto:hello@crabcake.kids?subject=Game%20Idea%20for%20Crabcake!&body=Hi!%20I%20have%20an%20idea%20for%20a%20new%20game%3A%0A%0A" onclick="showClaim('idea')">ğŸ’¡ Suggest a Game</a>
      </div>
      <div class="feedback-claim" id="feedback-claim-bug">
        <button class="feedback-claim-btn" onclick="claimFeedbackBadge('bug')">âœ… I sent it! Claim my ğŸ› Bug Hunter badge</button>
      </div>
      <div class="feedback-claim" id="feedback-claim-idea">
        <button class="feedback-claim-btn" onclick="claimFeedbackBadge('idea')">âœ… I sent it! Claim my ğŸ’¡ Big Ideas badge</button>
      </div>
    </div>
  </div>

<script>
// â”€â”€ SENTENCE DATA â”€â”€
const sentences = {
  5: [
    { words: ['The', 'cat', 'sits.'],          hint: 'ğŸ± Where does the cat sit?' },
    { words: ['I', 'like', 'dogs.'],            hint: 'ğŸ¶ What do you like?' },
    { words: ['She', 'can', 'run.'],            hint: 'ğŸƒ What can she do?' },
    { words: ['The', 'sun', 'shines.'],         hint: 'â˜€ï¸ What does the sun do?' },
    { words: ['A', 'big', 'bird', 'flew.'],     hint: 'ğŸ¦ What did the bird do?' },
    { words: ['He', 'has', 'a', 'ball.'],       hint: 'âš½ What does he have?' },
    { words: ['The', 'dog', 'ran', 'fast.'],    hint: 'ğŸ• How did the dog run?' },
    { words: ['I', 'love', 'my', 'mum.'],       hint: 'ğŸ’› Who do you love?' },
    { words: ['We', 'play', 'and', 'laugh.'],   hint: 'ğŸ˜„ What do we do?' },
    { words: ['The', 'fish', 'swims.'],         hint: 'ğŸŸ What does the fish do?' },
  ],
  7: [
    { words: ['The', 'monkey', 'climbed', 'the', 'tree.'],         hint: 'ğŸ’ Where did the monkey go?' },
    { words: ['She', 'found', 'a', 'golden', 'treasure.'],          hint: 'ğŸ’° What did she find?' },
    { words: ['The', 'explorer', 'crossed', 'the', 'river.'],       hint: 'ğŸŒŠ What did the explorer do?' },
    { words: ['A', 'parrot', 'sat', 'on', 'my', 'shoulder.'],       hint: 'ğŸ¦œ Where did the parrot sit?' },
    { words: ['Lions', 'roar', 'loudly', 'in', 'the', 'jungle.'],   hint: 'ğŸ¦ What do lions do?' },
    { words: ['He', 'packed', 'his', 'bag', 'for', 'adventure.'],   hint: 'ğŸ’ What did he pack?' },
    { words: ['The', 'butterflies', 'dance', 'in', 'the', 'sun.'],  hint: 'ğŸ¦‹ What do butterflies do?' },
    { words: ['She', 'heard', 'a', 'strange', 'jungle', 'sound.'],  hint: 'ğŸ‘‚ What did she hear?' },
    { words: ['The', 'vines', 'hang', 'from', 'tall', 'trees.'],    hint: 'ğŸŒ¿ Where do vines hang?' },
    { words: ['We', 'discovered', 'a', 'hidden', 'waterfall.'],     hint: 'ğŸ’§ What did we discover?' },
  ],
  9: [
    { words: ['The', 'brave', 'explorer', 'discovered', 'a', 'hidden', 'temple.'],             hint: 'ğŸ›ï¸ What did the explorer find?' },
    { words: ['Suddenly,', 'a', 'colourful', 'parrot', 'swooped', 'down', 'from', 'above.'],   hint: 'ğŸ¦œ What happened suddenly?' },
    { words: ['The', 'ancient', 'map', 'led', 'them', 'deep', 'into', 'the', 'jungle.'],       hint: 'ğŸ—ºï¸ Where did the map lead?' },
    { words: ['She', 'carefully', 'stepped', 'over', 'the', 'sleeping', 'crocodile.'],         hint: 'ğŸŠ What did she step over?' },
    { words: ['After', 'hours', 'of', 'hiking,', 'they', 'found', 'a', 'golden', 'river.'],    hint: 'ğŸ† What did they find?' },
    { words: ['The', 'tribe', 'welcomed', 'the', 'explorers', 'with', 'a', 'feast.'],          hint: 'ğŸ‰ How were the explorers welcomed?' },
    { words: ['Without', 'warning,', 'the', 'ground', 'began', 'to', 'shake', 'violently.'],   hint: 'ğŸ˜± What happened without warning?' },
    { words: ['They', 'used', 'a', 'rope', 'to', 'cross', 'the', 'deep', 'ravine.'],           hint: 'ğŸª¢ How did they cross?' },
    { words: ['The', 'mysterious', 'flower', 'glowed', 'brightly', 'in', 'the', 'dark.'],      hint: 'ğŸŒ¸ What did the flower do?' },
    { words: ['At', 'last,', 'the', 'treasure', 'chest', 'was', 'finally', 'opened.'],         hint: 'ğŸ’° What happened at last?' },
  ]
};

// â”€â”€ STATE â”€â”€
let selectedAge   = null;
let score         = 0;
let lives         = 3;
let sentencesDone = 0;
let gameRunning   = false;
let currentSentence   = [];
let builtSoFar        = [];
let nextWordIndex     = 0;
let sentenceQueue     = [];
let sentenceIndex     = 0;
const SENTENCES_PER_GAME = 8;

// â”€â”€ AMBIENT â”€â”€
function createJungleAmbience() {
  const bg = document.getElementById('jungleBg');
  // Vines
  for (let i = 0; i < 6; i++) {
    const v = document.createElement('div');
    v.className = 'vine';
    const h = Math.random() * 40 + 20;
    v.style.cssText = `
      left:${Math.random()*100}%;
      top:0; height:${h}%;
      animation-duration:${Math.random()*3+3}s;
      animation-delay:${Math.random()*2}s;
      opacity:${Math.random()*0.3+0.3};
    `;
    bg.appendChild(v);
  }
  // Fireflies
  for (let i = 0; i < 14; i++) {
    const f = document.createElement('div');
    f.className = 'firefly';
    const fx = (Math.random()-0.5)*120;
    const fy = -(Math.random()*150+50);
    f.style.cssText = `
      left:${Math.random()*100}%;
      top:${Math.random()*80+10}%;
      --fx:${fx}px; --fy:${fy}px;
      animation-duration:${Math.random()*4+3}s;
      animation-delay:${Math.random()*5}s;
    `;
    bg.appendChild(f);
  }
}

// â”€â”€ AGE SELECT â”€â”€
function selectAge(age) {
  selectedAge = age;
  document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('selected'));
  document.querySelector(`.age-btn[data-age="${age}"]`).classList.add('selected');
  document.getElementById('startBtn').classList.add('ready');
}

// â”€â”€ COUNTDOWN â”€â”€
function startCountdown() {
  if (!selectedAge || gameRunning) return;
  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('backLink').style.display = 'none';

  const el     = document.getElementById('countdown');
  const numEl  = document.getElementById('countdownNum');
  el.classList.remove('hidden');
  let count = 3;
  numEl.textContent = count;

  const tick = setInterval(() => {
    count--;
    if (count <= 0) {
      clearInterval(tick);
      numEl.textContent = 'ğŸŒ¿';
      setTimeout(() => { el.classList.add('hidden'); startGame(); }, 600);
    } else {
      numEl.style.animation = 'none';
      numEl.offsetHeight;
      numEl.style.animation = 'countPop 0.8s ease-out';
      numEl.textContent = count;
    }
  }, 900);
}

// â”€â”€ GAME START â”€â”€
function startGame() {
  if (gameRunning) return;
  gameRunning   = true;
  score         = 0;
  lives         = 3;
  sentencesDone = 0;
  sentenceIndex = 0;

  // Shuffle sentences
  const pool = [...sentences[selectedAge]];
  for (let i = pool.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [pool[i], pool[j]] = [pool[j], pool[i]];
  }
  sentenceQueue = pool.slice(0, SENTENCES_PER_GAME);

  updateHUD();
  buildProgressDots();

  document.getElementById('hud').classList.remove('hidden');
  document.getElementById('gameArea').classList.remove('hidden');

  loadSentence();
}

// â”€â”€ PROGRESS DOTS â”€â”€
function buildProgressDots() {
  const el = document.getElementById('progressDots');
  el.innerHTML = '';
  for (let i = 0; i < SENTENCES_PER_GAME; i++) {
    const d = document.createElement('div');
    d.className = 'dot' + (i === 0 ? ' current' : '');
    d.id = `dot-${i}`;
    el.appendChild(d);
  }
}

function updateProgressDots() {
  for (let i = 0; i < SENTENCES_PER_GAME; i++) {
    const d = document.getElementById(`dot-${i}`);
    if (!d) continue;
    d.className = 'dot';
    if (i < sentenceIndex) d.classList.add('done');
    else if (i === sentenceIndex) d.classList.add('current');
  }
}

// â”€â”€ LOAD SENTENCE â”€â”€
function loadSentence() {
  if (sentenceIndex >= sentenceQueue.length) { endGame(); return; }

  const s = sentenceQueue[sentenceIndex];
  currentSentence = s.words;
  builtSoFar      = [];
  nextWordIndex   = 0;

  // Hint
  document.getElementById('hintArea').textContent = s.hint;

  // Clear build zone
  const bz = document.getElementById('buildZone');
  bz.innerHTML = '';

  // Shuffle words for pool
  const shuffled = [...currentSentence].sort(() => Math.random() - 0.5);
  // Make sure it's actually shuffled (not in order)
  let attempts = 0;
  while (shuffled.join('') === currentSentence.join('') && attempts < 20) {
    shuffled.sort(() => Math.random() - 0.5);
    attempts++;
  }

  // Render word tiles
  const pool = document.getElementById('wordPool');
  pool.innerHTML = '';
  shuffled.forEach((word, i) => {
    const tile = document.createElement('div');
    tile.className = 'word-tile';
    tile.textContent = word;
    tile.dataset.word = word;
    tile.dataset.idx  = i;
    tile.addEventListener('click', () => onWordTap(tile, word));
    pool.appendChild(tile);
  });

  updateProgressDots();
  setSpeech('');
}

// â”€â”€ WORD TAP â”€â”€
function onWordTap(tile, word) {
  if (!gameRunning) return;
  const expected = currentSentence[nextWordIndex];

  if (word === expected) {
    // Correct
    tile.classList.add('used');
    builtSoFar.push(word);
    nextWordIndex++;
    addBuiltWord(word, true);
    playSound('tap');

    if (nextWordIndex === currentSentence.length) {
      // Sentence complete!
      setTimeout(() => completeSentence(), 300);
    }
  } else {
    // Wrong tap
    lives--;
    updateHUD();
    tile.style.animation = 'none';
    tile.offsetHeight;
    tile.style.animation = 'wrongShake 0.4s ease-out';
    tile.style.borderColor = 'var(--coral)';
    setTimeout(() => { tile.style.borderColor = ''; tile.style.animation = ''; }, 500);
    document.getElementById('character').classList.remove('ouch');
    void document.getElementById('character').offsetWidth;
    document.getElementById('character').classList.add('ouch');
    flashScreen('#FF6B6B');
    playSound('wrong');
    setSpeech(getOuchPhrase(), 1500);

    if (lives <= 0) { setTimeout(() => endGame(), 600); }
  }
}

function addBuiltWord(word, correct) {
  const bz = document.getElementById('buildZone');
  const el = document.createElement('div');
  el.className = 'built-word';
  el.textContent = word;
  bz.appendChild(el);
}

// â”€â”€ SENTENCE COMPLETE â”€â”€
function completeSentence() {
  score++;
  sentencesDone++;
  updateHUD();

  // Flash all built words green
  document.querySelectorAll('.built-word').forEach(w => w.classList.add('correct-flash'));

  // Character dance
  const char = document.getElementById('character');
  char.classList.remove('dance');
  void char.offsetWidth;
  char.classList.add('dance');
  setSpeech(getCelebPhrase(), 2000);

  flashScreen('#4CAF50');
  spawnConfetti();
  playSound('correct');

  setTimeout(() => {
    sentenceIndex++;
    if (sentenceIndex >= sentenceQueue.length || sentenceIndex >= SENTENCES_PER_GAME) {
      endGame();
    } else {
      loadSentence();
    }
  }, 2000);
}

// â”€â”€ PHRASES â”€â”€
function getCelebPhrase() {
  const p = ['Amazing! ğŸ‰', 'You got it! â­', 'Brilliant! ğŸ†', 'Nailed it! ğŸŒŸ', 'Superb! ğŸ¦', 'Roarsome! ğŸ¯'];
  return p[Math.floor(Math.random()*p.length)];
}
function getOuchPhrase() {
  const p = ['Oops! Try again!', 'Not quite! ğŸ™ˆ', 'Almost! ğŸ’', 'Keep going! ğŸ’ª', 'Whoops! ğŸŒ¿'];
  return p[Math.floor(Math.random()*p.length)];
}

function setSpeech(text, duration) {
  const el = document.getElementById('speechBubble');
  el.textContent = text;
  if (text) {
    el.classList.add('show');
    if (duration) setTimeout(() => el.classList.remove('show'), duration);
  } else {
    el.classList.remove('show');
  }
}

// â”€â”€ HUD â”€â”€
function updateHUD() {
  document.getElementById('scoreVal').textContent = score;
  document.getElementById('sentenceVal').textContent = sentencesDone;
  // Lives
  for (let i = 1; i <= 3; i++) {
    const h = document.getElementById(`h${i}`);
    if (i <= lives) h.classList.remove('lost');
    else            h.classList.add('lost');
  }
}

// â”€â”€ VISUAL FX â”€â”€
function flashScreen(color) {
  const f = document.createElement('div');
  f.className = 'flash-overlay';
  f.style.background = color;
  document.body.appendChild(f);
  setTimeout(() => f.remove(), 350);
}

function spawnConfetti() {
  const colors = ['#FFD54F','#4CAF50','#FF6B6B','#81D4FA','#CE93D8','#FFCC02'];
  const cx = window.innerWidth / 2, cy = window.innerHeight * 0.4;
  for (let i = 0; i < 28; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    const angle = Math.random() * Math.PI * 2;
    const dist  = Math.random() * 120 + 30;
    el.style.cssText = `
      left:${cx + Math.cos(angle)*dist}px;
      top:${cy + Math.sin(angle)*dist - 40}px;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      width:${Math.random()*10+5}px; height:${Math.random()*10+5}px;
      border-radius:${Math.random()<0.5?'50%':'2px'};
      animation-duration:${Math.random()*0.6+0.5}s;
    `;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1100);
  }
}

function showFeedback(text, color) {
  const el = document.createElement('div');
  el.className = 'feedback-pop';
  el.textContent = text;
  el.style.cssText = `left:50%; top:40%; transform:translateX(-50%); color:${color};`;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 900);
}

// â”€â”€ SOUNDS â”€â”€
let audioCtx = null;
function getAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
function playSound(type) {
  try {
    const ac   = getAudio();
    const osc  = ac.createOscillator();
    const gain = ac.createGain();
    osc.connect(gain); gain.connect(ac.destination);
    if (type === 'tap') {
      osc.frequency.setValueAtTime(440, ac.currentTime);
      gain.gain.setValueAtTime(0.08, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + 0.15);
      osc.start(ac.currentTime); osc.stop(ac.currentTime + 0.15);
    } else if (type === 'correct') {
      osc.frequency.setValueAtTime(523, ac.currentTime);
      osc.frequency.setValueAtTime(659, ac.currentTime + 0.1);
      osc.frequency.setValueAtTime(784, ac.currentTime + 0.2);
      gain.gain.setValueAtTime(0.15, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + 0.5);
      osc.start(ac.currentTime); osc.stop(ac.currentTime + 0.5);
    } else {
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(200, ac.currentTime);
      osc.frequency.setValueAtTime(140, ac.currentTime + 0.12);
      gain.gain.setValueAtTime(0.1, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + 0.25);
      osc.start(ac.currentTime); osc.stop(ac.currentTime + 0.25);
    }
  } catch(e) {}
}

// â”€â”€ END GAME â”€â”€
function endGame() {
  gameRunning = false;
  document.getElementById('hud').classList.add('hidden');
  document.getElementById('gameArea').classList.add('hidden');

  let rating, title, message;
  if (score === 0) {
    rating = 'ğŸŒ¿'; title = 'Keep Exploring!';
    message = "The jungle is full of surprises â€” try again!";
  } else if (score <= 2) {
    rating = 'â­'; title = 'Good Try!';
    message = 'Nice exploring! Can you build more sentences next time?';
  } else if (score <= 4) {
    rating = 'â­â­'; title = 'Great Explorer!';
    message = 'The jungle is yours! Keep practising to reach the top!';
  } else if (score <= 6) {
    rating = 'â­â­â­'; title = 'Jungle Master!';
    message = 'Incredible! You\'re a true word explorer! ğŸ¦';
  } else {
    rating = 'ğŸ†âœ¨'; title = 'LEGEND OF THE JUNGLE!';
    message = 'Perfect run! The jungle bows before you! ğŸŒ¿ğŸ¦ğŸŒ¿';
    spawnConfetti();
    setTimeout(spawnConfetti, 400);
    setTimeout(spawnConfetti, 800);
  }

  document.getElementById('endRating').textContent  = rating;
  document.getElementById('endTitle').textContent    = title;
  document.getElementById('endScoreNum').textContent = score;
  document.getElementById('endScoreSub').textContent = `out of ${Math.min(sentenceIndex, SENTENCES_PER_GAME)} sentences`;
  document.getElementById('endMessage').textContent  = message;
  document.getElementById('endScreen').classList.remove('hidden');
  document.getElementById('backLink').style.display  = 'block';

  // Award badges
  awardJungleWordsBadges(score, selectedAge);
}

function playAgain() {
  document.getElementById('endScreen').classList.add('hidden');
  document.getElementById('backLink').style.display = 'none';
  gameRunning = false;
  startCountdown();
}

function changeLevel() {
  document.getElementById('endScreen').classList.add('hidden');
  document.getElementById('startScreen').classList.remove('hidden');
  document.getElementById('backLink').style.display = 'none';
  document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById('startBtn').classList.remove('ready');
  selectedAge = null;
  gameRunning = false;
}

function hudBack() {
  gameRunning = false;
  document.getElementById('hud').classList.add('hidden');
  document.getElementById('gameArea').classList.add('hidden');
  changeLevel();
}

// â”€â”€ Feedback badge claim â”€â”€
function showClaim(type) {
  setTimeout(() => {
    const el = document.getElementById('feedback-claim-' + type);
    if (el) el.style.display = 'block';
  }, 800);
}
function claimFeedbackBadge(type) {
  const id = type === 'bug' ? 'cg_bughunter' : 'cg_bigideas';
  const btn = document.querySelector(`#feedback-claim-${type} .feedback-claim-btn`);
  if (_award(id)) {
    _toast(id);
    if (btn) { btn.textContent = 'ğŸ† Badge earned!'; btn.disabled = true; }
  } else {
    if (btn) { btn.textContent = 'âœ… Already earned!'; btn.disabled = true; }
  }
}

// â”€â”€ INIT â”€â”€
createJungleAmbience();
document.getElementById('backLink').style.display = 'block';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BADGE ENGINE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BADGE_DEF={
  md_first:{game:'mathdive',em:'ğŸ¤¿',name:'First Dive',desc:'Complete your first Math Dive game'},
  md_sharp:{game:'mathdive',em:'â­',name:'Sharp Shooter',desc:'Score 10+ correct answers in one game'},
  md_fire:{game:'mathdive',em:'ğŸ”¥',name:'On Fire',desc:'Reach a 5Ã— streak in Math Dive'},
  md_speed:{game:'mathdive',em:'âš¡',name:'Speed Demon',desc:'Score 15+ correct answers in one game'},
  md_legend:{game:'mathdive',em:'ğŸ†',name:'Legendary Diver',desc:'Score 20+ correct answers in one game'},
  md_times:{game:'mathdive',em:'ğŸ§®',name:'Times Master',desc:'Complete a game on the Ages 9â€“10 level'},
  jw_first:{game:'junglewords',em:'ğŸ¦',name:'First Words',desc:'Complete your first Jungle Words game'},
  jw_builder:{game:'junglewords',em:'ğŸ“',name:'Sentence Builder',desc:'Build 5+ correct sentences in one game'},
  jw_wizard:{game:'junglewords',em:'ğŸŒŸ',name:'Word Wizard',desc:'Finish a game without losing a life'},
  jw_elite:{game:'junglewords',em:'ğŸ…',name:'Explorer Elite',desc:'Score 8/8 sentences in one game'},
  wb_first:{game:'witchbrew',em:'ğŸ§™â€â™€ï¸',name:'Apprentice Witch',desc:'Brew your first successful potion'},
  wb_rare:{game:'witchbrew',em:'ğŸ”µ',name:'Rare Find',desc:'Discover a Rare potion'},
  wb_epic:{game:'witchbrew',em:'ğŸŸ£',name:'Epic Brewer',desc:'Discover an Epic potion'},
  wb_legend:{game:'witchbrew',em:'ğŸŸ ',name:'Legendary!',desc:'Discover a Legendary potion'},
  wb_collect:{game:'witchbrew',em:'ğŸ“–',name:'Spell Collector',desc:'Discover 10 or more potions total'},
  wb_streak:{game:'witchbrew',em:'ğŸ”¥',name:'On A Roll',desc:'Achieve a 3Ã— brew streak'},
  ts_first:{game:'tubesort',em:'ğŸ§ª',name:'First Sort',desc:'Complete Level 1 of Tube Sort'},
  ts_perfect:{game:'tubesort',em:'ğŸ’',name:'Perfectionist',desc:'Complete a level earning 3 stars'},
  ts_speed:{game:'tubesort',em:'âš¡',name:'Speed Sorter',desc:'Complete Level 5 or beyond'},
  ts_master:{game:'tubesort',em:'ğŸ‘‘',name:'Tube Master',desc:'Reach Level 10 in Tube Sort'},
  cg_fan:{game:'crabcake',em:'ğŸ¦€',name:'Crabcake Fan',desc:'Play all 4 Crabcake games at least once'},
  cg_allround:{game:'crabcake',em:'ğŸŒŸ',name:'All-Rounder',desc:'Earn at least one badge in every game'},
  cg_dedicated:{game:'crabcake',em:'ğŸ®',name:'Dedicated',desc:'Play 10 games total across all games'},
  cg_bughunter:{game:'crabcake',em:'ğŸ›',name:'Bug Hunter',desc:'Reported a bug to help improve Crabcake'},
  cg_bigideas:{game:'crabcake',em:'ğŸ’¡',name:'Big Ideas',desc:'Suggested a new game idea for Crabcake'},
};
const BADGE_KEY='crabcake_badges_v1';
const PLAYS_KEY='crabcake_plays_v1';
function _lb(){try{return JSON.parse(localStorage.getItem(BADGE_KEY)||'{}');}catch{return{};}}
function _sb(d){try{localStorage.setItem(BADGE_KEY,JSON.stringify(d));}catch{}}
function _lp(){try{return JSON.parse(localStorage.getItem(PLAYS_KEY)||'{}');}catch{return{};}}
function _sp(d){try{localStorage.setItem(PLAYS_KEY,JSON.stringify(d));}catch{}}
function _award(id){const d=_lb();if(d[id])return false;d[id]={earned:true,date:new Date().toLocaleDateString()};_sb(d);return true;}
function _incPlays(game){const p=_lp();p[game]=(p[game]||0)+1;p._total=(p._total||0)+1;_sp(p);return p;}
let _tq=[],_tb=false;
function _toast(id){_tq.push(id);if(!_tb)_nxt();}
function _nxt(){
  if(!_tq.length){_tb=false;return;}_tb=true;
  const id=_tq.shift();const b=BADGE_DEF[id];if(!b){_nxt();return;}
  let t=document.getElementById('_bgt');
  if(!t){t=document.createElement('div');t.id='_bgt';t.className='badge-toast';
    t.innerHTML='<div class="badge-toast-em" id="_bge"></div><div class="badge-toast-text"><div class="badge-toast-label">ğŸ† Badge Unlocked!</div><div class="badge-toast-name" id="_bgn"></div><div class="badge-toast-desc" id="_bgd"></div></div>';
    document.body.appendChild(t);}
  document.getElementById('_bge').textContent=b.em;
  document.getElementById('_bgn').textContent=b.name;
  document.getElementById('_bgd').textContent=b.desc;
  t.classList.add('show');
  setTimeout(()=>{t.classList.remove('show');setTimeout(_nxt,500);},3500);
}
function _crossCheck(ne){
  const p=_lp();
  const games=['mathdive','junglewords','witchbrew','tubesort'];
  if(!_lb().cg_fan&&games.every(g=>(p[g]||0)>=1)){if(_award('cg_fan'))ne.push('cg_fan');}
  const d=_lb();
  const gm={mathdive:false,junglewords:false,witchbrew:false,tubesort:false};
  Object.keys(BADGE_DEF).forEach(id=>{const b=BADGE_DEF[id];if(b.game!=='crabcake'&&d[id])gm[b.game]=true;});
  if(!d.cg_allround&&Object.values(gm).every(Boolean)){if(_award('cg_allround'))ne.push('cg_allround');}
  const d2=_lb();
  if(!d2.cg_dedicated&&(p._total||0)>=10){if(_award('cg_dedicated'))ne.push('cg_dedicated');}
}
function _renderEndBadges(ne){
  const wrap=document.getElementById('endBadgesWrap');
  const row=document.getElementById('endBadgesRow');
  if(!wrap||!row)return;
  const all=Object.keys(_lb());
  if(!all.length&&!ne.length){wrap.style.display='none';return;}
  wrap.style.display='';
  const title=wrap.querySelector('.badges-section-title');
  if(title)title.textContent=ne.length?`ğŸ† Badge${ne.length>1?'s':''} Earned This Game!`:'ğŸ† Your Badges';
  const show=ne.length?ne:all.slice(0,6);
  row.innerHTML=show.map(id=>{const b=BADGE_DEF[id];if(!b)return'';
    return`<div class="badge-coin${ne.includes(id)?' new-badge':''}" title="${b.desc}"><div class="badge-coin-em">${b.em}</div><div class="badge-coin-name">${b.name}</div></div>`;
  }).join('');
}

// â”€â”€ Jungle Words: award badges at game end â”€â”€
function awardJungleWordsBadges(sc, lv) {
  const ne = [];
  _incPlays('junglewords');
  if (_award('jw_first')) ne.push('jw_first');
  if (sc >= 5 && _award('jw_builder')) ne.push('jw_builder');
  if (sc >= 8 && _award('jw_elite')) ne.push('jw_elite');
  if (sc >= 1 && lives >= 3 && _award('jw_wizard')) ne.push('jw_wizard');
  _crossCheck(ne);
  ne.forEach(id => _toast(id));
  setTimeout(() => _renderEndBadges(ne), 400);
}
</script>
</body>
</html>
