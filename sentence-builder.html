<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>Jungle Words üåø | Crabcake</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@700;800;900&display=swap"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --jungle-dark:  #0d2818;
      --jungle-mid:   #1a4a2e;
      --jungle-light: #2d6e47;
      --leaf:         #4CAF50;
      --leaf2:        #66BB6A;
      --gold:         #FFD54F;
      --gold2:        #FFA000;
      --coral:        #FF6B6B;
      --sky:          #81D4FA;
      --brown:        #795548;
      --tan:          #BCAAA4;
      --white:        #ffffff;
      --cream:        #FFF8E1;
    }

    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      background: var(--jungle-dark);
      font-family: 'Nunito', sans-serif;
      touch-action: manipulation;
    }

    /* ‚îÄ‚îÄ JUNGLE BACKGROUND ‚îÄ‚îÄ */
    .jungle-bg {
      position: fixed; inset: 0; z-index: 0; overflow: hidden;
      background: linear-gradient(180deg, #071a0f 0%, #0d2818 35%, #1a4a2e 70%, #0d2818 100%);
    }
    .jungle-bg::before {
      content: '';
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 600px 400px at 15% 40%, rgba(76,175,80,0.08) 0%, transparent 70%),
        radial-gradient(ellipse 500px 300px at 85% 60%, rgba(102,187,106,0.06) 0%, transparent 70%);
    }

    /* Animated vines */
    .vine {
      position: absolute;
      width: 3px;
      background: linear-gradient(180deg, transparent, #2d6e47, #1a4a2e);
      border-radius: 3px;
      transform-origin: top center;
      animation: vineSwing ease-in-out infinite;
      opacity: 0.6;
    }
    @keyframes vineSwing {
      0%,100% { transform: rotate(-8deg); }
      50%      { transform: rotate(8deg); }
    }

    /* Jungle floor */
    .jungle-floor {
      position: fixed; bottom: 0; left: 0; right: 0;
      height: 70px; z-index: 1; pointer-events: none;
      background: linear-gradient(180deg, transparent, rgba(13,40,24,0.9));
    }
    .jungle-floor::after {
      content: 'üåø üå∫ üçÑ üåø üå∏ üçÉ üåø üå∫ üçÑ üå∏ üåø üçÉ üå∫ üåø';
      position: absolute; bottom: 4px; left: 0; right: 0;
      text-align: center; font-size: 1.3rem; letter-spacing: 6px; opacity: 0.8;
    }

    /* Fireflies */
    .firefly {
      position: absolute;
      width: 4px; height: 4px;
      border-radius: 50%;
      background: #FFD54F;
      box-shadow: 0 0 6px 2px rgba(255,213,79,0.8);
      animation: fireflyFloat linear infinite;
      pointer-events: none;
    }
    @keyframes fireflyFloat {
      0%   { opacity: 0; transform: translate(0, 0); }
      20%  { opacity: 1; }
      80%  { opacity: 0.8; }
      100% { opacity: 0; transform: translate(var(--fx), var(--fy)); }
    }

    /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
    .screen {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 10; padding: 1.5rem;
      transition: opacity 0.35s, transform 0.35s;
    }
    .screen.hidden {
      opacity: 0; pointer-events: none;
      touch-action: none; display: none;
    }

    /* ‚îÄ‚îÄ START SCREEN ‚îÄ‚îÄ */
    #startScreen { gap: 0; }

    .game-icon {
      font-size: 5rem;
      animation: iconBob 2.5s ease-in-out infinite;
      filter: drop-shadow(0 8px 20px rgba(76,175,80,0.4));
      margin-bottom: 0.5rem;
    }
    @keyframes iconBob {
      0%,100% { transform: translateY(0) rotate(-5deg); }
      50%      { transform: translateY(-12px) rotate(5deg); }
    }

    .game-title {
      font-family: 'Fredoka One', cursive;
      font-size: clamp(3rem, 9vw, 5.5rem);
      color: var(--gold);
      text-shadow: 3px 3px 0 rgba(0,0,0,0.4), 0 0 40px rgba(255,213,79,0.3);
      text-align: center;
      line-height: 1;
      margin-bottom: 0.3rem;
    }
    .game-subtitle {
      font-size: clamp(0.75rem, 2.2vw, 0.95rem);
      font-weight: 900;
      color: var(--leaf2);
      letter-spacing: 3px;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .age-select-label {
      font-size: 0.75rem; font-weight: 900;
      color: rgba(255,255,255,0.45);
      letter-spacing: 2px; text-transform: uppercase;
      text-align: center; margin-bottom: 0.9rem;
    }
    .age-buttons { display: flex; gap: 0.9rem; flex-wrap: wrap; justify-content: center; margin-bottom: 2rem; }
    .age-btn {
      padding: 0.9rem 1.4rem;
      border: 3px solid rgba(255,255,255,0.1);
      border-radius: 16px;
      font-family: 'Nunito', sans-serif; font-weight: 900;
      cursor: pointer; background: rgba(255,255,255,0.05);
      color: white; min-width: 105px;
      display: flex; flex-direction: column; align-items: center; gap: 3px;
      transition: all 0.2s;
    }
    .age-btn .age-emoji { font-size: 1.5rem; }
    .age-btn .age-label { font-size: 0.85rem; }
    .age-btn .age-topic { font-size: 0.62rem; opacity: 0.65; text-align: center; }
    .age-btn:hover { transform: translateY(-3px); background: rgba(255,255,255,0.1); }
    .age-btn[data-age="5"].selected  { border-color: var(--leaf);  background: rgba(76,175,80,0.2); }
    .age-btn[data-age="7"].selected  { border-color: var(--gold);  background: rgba(255,213,79,0.15); }
    .age-btn[data-age="9"].selected  { border-color: var(--coral); background: rgba(255,107,107,0.15); }

    .start-btn {
      padding: 1rem 3rem;
      background: linear-gradient(135deg, var(--leaf), #388E3C);
      color: white;
      border: none; border-radius: 50px;
      font-family: 'Fredoka One', cursive; font-size: 1.8rem;
      cursor: pointer;
      box-shadow: 0 6px 0 #1B5E20, 0 8px 24px rgba(76,175,80,0.35);
      transition: all 0.15s; opacity: 0.4; pointer-events: none;
    }
    .start-btn.ready { opacity: 1; pointer-events: all; }
    .start-btn.ready:hover  { transform: translateY(-3px); box-shadow: 0 9px 0 #1B5E20, 0 12px 28px rgba(76,175,80,0.45); }
    .start-btn.ready:active { transform: translateY(2px);  box-shadow: 0 3px 0 #1B5E20; }

    /* ‚îÄ‚îÄ HUD ‚îÄ‚îÄ */
    #hud {
      position: fixed; top: 0; left: 0; right: 0; z-index: 20;
      display: flex; justify-content: space-between; align-items: center;
      padding: 0.7rem 1.2rem;
      background: rgba(7,26,15,0.88);
      backdrop-filter: blur(8px);
      border-bottom: 2px solid rgba(76,175,80,0.35);
    }
    #hud.hidden { display: none; }
    .hud-item { display: flex; flex-direction: column; align-items: center; gap: 1px; }
    .hud-label { font-size: 0.52rem; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,0.4); }
    .hud-value { font-family: 'Fredoka One', cursive; font-size: 1.7rem; color: var(--gold); line-height: 1; }

    .hud-btn {
      display: flex; flex-direction: column; align-items: center; gap: 2px;
      background: rgba(255,255,255,0.07); border: 2px solid rgba(255,255,255,0.12);
      border-radius: 12px; padding: 0.3rem 0.7rem;
      cursor: pointer; transition: all 0.15s; text-decoration: none;
    }
    .hud-btn:hover { background: rgba(255,255,255,0.14); transform: translateY(-2px); }
    .hud-btn-icon  { font-size: 1.2rem; line-height: 1; }
    .hud-btn-label { font-size: 0.5rem; font-weight: 900; letter-spacing: 1.5px; text-transform: uppercase; color: rgba(255,255,255,0.4); }

    /* Lives */
    .lives-display { display: flex; gap: 4px; align-items: center; }
    .life-heart { font-size: 1.4rem; transition: transform 0.2s; }
    .life-heart.lost { filter: grayscale(1) opacity(0.3); transform: scale(0.8); }

    /* Sentence counter */
    #sentenceVal { color: var(--leaf2); }

    /* ‚îÄ‚îÄ GAME AREA ‚îÄ‚îÄ */
    #gameArea {
      position: fixed; inset: 0; z-index: 5;
      display: flex; flex-direction: column;
      align-items: center;
      padding-top: 80px; padding-bottom: 80px;
      gap: 1rem;
    }
    #gameArea.hidden { display: none; }

    /* Build zone ‚Äî where tapped words go */
    .build-zone {
      width: 100%; max-width: 600px;
      min-height: 64px;
      background: rgba(255,248,225,0.06);
      border: 2px dashed rgba(255,213,79,0.3);
      border-radius: 20px;
      padding: 0.8rem 1rem;
      display: flex; flex-wrap: wrap; gap: 8px;
      align-items: center; justify-content: center;
    }
    .build-zone-label {
      font-size: 0.6rem; font-weight: 900; letter-spacing: 2px;
      text-transform: uppercase; color: rgba(255,213,79,0.4);
      text-align: center; margin-bottom: 4px;
      width: 100%;
    }
    .built-word {
      padding: 0.45rem 1rem;
      background: linear-gradient(135deg, rgba(255,213,79,0.2), rgba(255,160,0,0.15));
      border: 2px solid rgba(255,213,79,0.5);
      border-radius: 50px;
      font-family: 'Fredoka One', cursive;
      font-size: clamp(1rem, 3.5vw, 1.3rem);
      color: var(--gold);
      animation: wordPlop 0.25s cubic-bezier(0.34,1.56,0.64,1);
    }
    @keyframes wordPlop {
      0%   { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .built-word.correct-flash {
      background: linear-gradient(135deg, rgba(76,175,80,0.4), rgba(56,142,60,0.3));
      border-color: var(--leaf2);
      color: #C8E6C9;
    }
    .built-word.wrong-shake {
      animation: wrongShake 0.4s ease-out;
      border-color: var(--coral);
      background: rgba(255,107,107,0.2);
    }
    @keyframes wrongShake {
      0%,100% { transform: translateX(0); }
      20%     { transform: translateX(-8px); }
      40%     { transform: translateX(8px); }
      60%     { transform: translateX(-6px); }
      80%     { transform: translateX(6px); }
    }

    /* Word pool ‚Äî the scrambled words to tap */
    .word-pool {
      width: 100%; max-width: 600px;
      display: flex; flex-wrap: wrap; gap: 10px;
      justify-content: center; align-items: center;
      padding: 0.5rem;
    }
    .word-tile {
      padding: 0.7rem 1.2rem;
      background: linear-gradient(135deg, var(--jungle-light), var(--jungle-mid));
      border: 3px solid rgba(76,175,80,0.5);
      border-radius: 14px;
      font-family: 'Fredoka One', cursive;
      font-size: clamp(1.1rem, 4vw, 1.5rem);
      color: var(--cream);
      cursor: pointer;
      transition: all 0.15s;
      box-shadow: 0 4px 0 rgba(0,0,0,0.3), 0 6px 14px rgba(0,0,0,0.2);
      user-select: none; -webkit-user-select: none;
    }
    .word-tile:hover  { transform: translateY(-3px); border-color: var(--leaf2); background: linear-gradient(135deg, #3a8a52, #2d6e47); }
    .word-tile:active { transform: translateY(1px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
    .word-tile.used   { opacity: 0.25; pointer-events: none; transform: scale(0.9); }

    /* Hint */
    .hint-area {
      font-size: clamp(0.75rem, 2.5vw, 0.9rem);
      font-weight: 800;
      color: rgba(255,255,255,0.35);
      text-align: center;
      font-style: italic;
      padding: 0 1rem;
    }

    /* Progress dots */
    .progress-dots {
      display: flex; gap: 6px; justify-content: center;
    }
    .dot {
      width: 10px; height: 10px; border-radius: 50%;
      background: rgba(255,255,255,0.15);
      transition: background 0.3s, transform 0.3s;
    }
    .dot.done    { background: var(--leaf2); transform: scale(1.2); }
    .dot.current { background: var(--gold); transform: scale(1.3); box-shadow: 0 0 8px rgba(255,213,79,0.5); }

    /* ‚îÄ‚îÄ CHARACTER ‚îÄ‚îÄ */
    .character-wrap {
      position: relative;
      display: flex; flex-direction: column; align-items: center;
      z-index: 25;
    }
    .character {
      font-size: clamp(3.5rem, 10vw, 5rem);
      line-height: 1;
      transition: transform 0.2s;
    }
    .character.dance {
      animation: danceMoves 0.8s ease-in-out;
    }
    @keyframes danceMoves {
      0%   { transform: translateY(0) rotate(0deg) scale(1); }
      15%  { transform: translateY(-20px) rotate(-15deg) scale(1.1); }
      30%  { transform: translateY(-15px) rotate(15deg) scale(1.15); }
      45%  { transform: translateY(-25px) rotate(-10deg) scale(1.2); }
      60%  { transform: translateY(-18px) rotate(12deg) scale(1.15); }
      75%  { transform: translateY(-10px) rotate(-8deg) scale(1.1); }
      100% { transform: translateY(0) rotate(0deg) scale(1); }
    }
    .character.ouch {
      animation: ouchWiggle 0.4s ease-out;
    }
    @keyframes ouchWiggle {
      0%,100% { transform: rotate(0deg); }
      25%     { transform: rotate(-12deg) translateX(-5px); }
      75%     { transform: rotate(12deg)  translateX(5px); }
    }
    .speech-bubble {
      position: fixed;
      top: 75px;
      left: 50%;
      transform: translateX(-50%) scale(0.8) translateY(10px);
      background: white;
      color: var(--jungle-dark);
      border-radius: 16px;
      padding: 0.5rem 1.2rem;
      font-weight: 900;
      font-size: 1rem;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s, transform 0.2s;
      z-index: 50;
    }
    .speech-bubble::after {
      content: '';
      position: absolute;
      top: -8px; left: 50%; transform: translateX(-50%);
      border: 8px solid transparent;
      border-bottom-color: white;
      border-top: none;
    }
    .speech-bubble.show {
      opacity: 1;
      transform: translateX(-50%) scale(1) translateY(0);
    }

    /* ‚îÄ‚îÄ FEEDBACK FLASH ‚îÄ‚îÄ */
    .feedback-pop {
      position: fixed;
      font-family: 'Fredoka One', cursive;
      font-size: 2rem; pointer-events: none; z-index: 30;
      animation: feedbackAnim 0.9s ease-out forwards;
    }
    @keyframes feedbackAnim {
      0%   { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.4); }
    }
    .confetti-piece {
      position: fixed; border-radius: 2px;
      pointer-events: none; z-index: 35;
      animation: confettiFall linear forwards;
    }
    @keyframes confettiFall {
      0%   { opacity: 1; transform: translateY(0) rotate(0deg); }
      100% { opacity: 0; transform: translateY(200px) rotate(720deg); }
    }

    /* Flash overlay */
    .flash-overlay {
      position: fixed; inset: 0; z-index: 25; pointer-events: none;
      animation: flashFade 0.35s ease-out forwards;
    }
    @keyframes flashFade { 0% { opacity: 0.2; } 100% { opacity: 0; } }

    /* ‚îÄ‚îÄ COUNTDOWN ‚îÄ‚îÄ */
    #countdown {
      position: fixed; inset: 0; z-index: 40;
      display: flex; align-items: center; justify-content: center;
      background: rgba(7,26,15,0.75); backdrop-filter: blur(4px);
    }
    #countdown.hidden { display: none; }
    .countdown-num {
      font-family: 'Fredoka One', cursive;
      font-size: 12rem; color: var(--gold);
      text-shadow: 0 0 60px rgba(255,213,79,0.5);
      animation: countPop 0.8s ease-out;
    }
    @keyframes countPop {
      0%   { transform: scale(2); opacity: 0; }
      40%  { transform: scale(0.9); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* ‚îÄ‚îÄ END SCREEN ‚îÄ‚îÄ */
    #endScreen { gap: 1rem; }
    .end-rating { font-size: 3rem; text-align: center; }
    .end-title {
      font-family: 'Fredoka One', cursive;
      font-size: clamp(2rem, 7vw, 3.5rem);
      color: var(--gold);
      text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
      text-align: center;
    }
    .end-score-box {
      background: rgba(255,255,255,0.06);
      border: 2px solid rgba(76,175,80,0.35);
      border-radius: 24px;
      padding: 1.2rem 2.5rem;
      text-align: center;
    }
    .end-score-label { font-size: 0.65rem; font-weight: 900; letter-spacing: 3px; text-transform: uppercase; color: var(--leaf2); margin-bottom: 0.3rem; }
    .end-score-num   { font-family: 'Fredoka One', cursive; font-size: 4rem; color: var(--gold); line-height: 1; }
    .end-score-sub   { font-size: 0.8rem; font-weight: 700; color: rgba(255,255,255,0.5); margin-top: 0.3rem; }
    .end-message     { font-size: 1rem; font-weight: 800; color: rgba(255,255,255,0.8); text-align: center; max-width: 320px; }
    .end-buttons     { display: flex; gap: 0.9rem; flex-wrap: wrap; justify-content: center; }
    .end-btn {
      padding: 0.8rem 1.8rem; border: none; border-radius: 50px;
      font-family: 'Fredoka One', cursive; font-size: 1.4rem;
      cursor: pointer; transition: all 0.15s;
      box-shadow: 0 4px 0 rgba(0,0,0,0.3);
    }
    .end-btn:hover  { transform: translateY(-2px); }
    .end-btn:active { transform: translateY(1px); box-shadow: 0 2px 0 rgba(0,0,0,0.3); }
    .btn-play-again   { background: var(--leaf); color: white; }
    .btn-change-level { background: rgba(255,255,255,0.1); color: white; border: 2px solid rgba(255,255,255,0.2); }
    .btn-home         { background: rgba(255,255,255,0.1); color: white; border: 2px solid rgba(255,255,255,0.2); text-decoration: none; display: inline-flex; align-items: center; }

    .back-link {
      position: fixed; top: 1rem; left: 1rem; z-index: 50;
      color: rgba(255,255,255,0.35); font-size: 0.8rem; font-weight: 900;
      letter-spacing: 1px; text-decoration: none; text-transform: uppercase;
      transition: color 0.2s;
    }
    .back-link:hover { color: var(--leaf2); }
  </style>
</head>
<body>

  <div class="jungle-bg" id="jungleBg"></div>
  <div class="jungle-floor"></div>
  <a href="index.html" class="back-link" id="backLink">‚Üê Back</a>

  <!-- START SCREEN -->
  <div class="screen" id="startScreen">
    <div class="game-icon">ü¶Å</div>
    <div class="game-title">Jungle Words!</div>
    <div class="game-subtitle">Crabcake ¬∑ Educational Games</div>

    <div class="age-select-label">Choose your explorer</div>
    <div class="age-buttons">
      <button class="age-btn" data-age="5" onclick="selectAge(5)">
        <span class="age-emoji">üü¢</span>
        <span class="age-label">Ages 5‚Äì6</span>
        <span class="age-topic">2‚Äì3 word<br>sentences</span>
      </button>
      <button class="age-btn" data-age="7" onclick="selectAge(7)">
        <span class="age-emoji">üü°</span>
        <span class="age-label">Ages 7‚Äì8</span>
        <span class="age-topic">4‚Äì5 word<br>sentences</span>
      </button>
      <button class="age-btn" data-age="9" onclick="selectAge(9)">
        <span class="age-emoji">üî¥</span>
        <span class="age-label">Ages 9‚Äì10</span>
        <span class="age-topic">Longer sentences<br>with punctuation</span>
      </button>
    </div>
    <button class="start-btn" id="startBtn" onclick="startCountdown()">üåø Explore!</button>
  </div>

  <!-- COUNTDOWN -->
  <div id="countdown" class="hidden">
    <div class="countdown-num" id="countdownNum">3</div>
  </div>

  <!-- HUD -->
  <div id="hud" class="hidden">
    <div class="hud-item">
      <div class="hud-label">Score</div>
      <div class="hud-value" id="scoreVal">0</div>
    </div>
    <button class="hud-btn" onclick="hudBack()" title="Level Select">
      <span class="hud-btn-icon">‚Ü©Ô∏è</span>
      <span class="hud-btn-label">Levels</span>
    </button>
    <div class="hud-item">
      <div class="hud-label">Lives</div>
      <div class="lives-display" id="livesDisplay">
        <span class="life-heart" id="h1">‚ù§Ô∏è</span>
        <span class="life-heart" id="h2">‚ù§Ô∏è</span>
        <span class="life-heart" id="h3">‚ù§Ô∏è</span>
      </div>
    </div>
    <a class="hud-btn" href="index.html#games" title="Home">
      <span class="hud-btn-icon">üè†</span>
      <span class="hud-btn-label">Home</span>
    </a>
    <div class="hud-item">
      <div class="hud-label">Done</div>
      <div class="hud-value" id="sentenceVal">0</div>
    </div>
  </div>

  <!-- GAME AREA -->
  <div id="gameArea" class="hidden">
    <!-- Progress dots -->
    <div class="progress-dots" id="progressDots"></div>

    <!-- Character -->
    <div class="character-wrap">
      <div class="speech-bubble" id="speechBubble">Amazing! üéâ</div>
      <div class="character" id="character">ü¶Å</div>
    </div>

    <!-- Build zone -->
    <div>
      <div class="build-zone-label">Build the sentence</div>
      <div class="build-zone" id="buildZone"></div>
    </div>

    <!-- Hint -->
    <div class="hint-area" id="hintArea"></div>

    <!-- Word pool -->
    <div class="word-pool" id="wordPool"></div>
  </div>

  <!-- END SCREEN -->
  <div class="screen hidden" id="endScreen">
    <div class="end-rating" id="endRating">‚≠ê‚≠ê‚≠ê</div>
    <div class="end-title" id="endTitle">Jungle Master!</div>
    <div class="end-score-box">
      <div class="end-score-label">Sentences Built</div>
      <div class="end-score-num" id="endScoreNum">0</div>
      <div class="end-score-sub" id="endScoreSub">correct sentences</div>
    </div>
    <div class="end-message" id="endMessage">Great exploring!</div>
    <div class="end-buttons">
      <button class="end-btn btn-play-again" onclick="playAgain()">üåø Play Again!</button>
      <button class="end-btn btn-change-level" onclick="changeLevel()">Change Level</button>
      <a href="index.html" class="end-btn btn-home">ü¶Ä Home</a>
    </div>
  </div>

<script>
// ‚îÄ‚îÄ SENTENCE DATA ‚îÄ‚îÄ
const sentences = {
  5: [
    { words: ['The', 'cat', 'sits.'],          hint: 'üê± Where does the cat sit?' },
    { words: ['I', 'like', 'dogs.'],            hint: 'üê∂ What do you like?' },
    { words: ['She', 'can', 'run.'],            hint: 'üèÉ What can she do?' },
    { words: ['The', 'sun', 'shines.'],         hint: '‚òÄÔ∏è What does the sun do?' },
    { words: ['A', 'big', 'bird', 'flew.'],     hint: 'üê¶ What did the bird do?' },
    { words: ['He', 'has', 'a', 'ball.'],       hint: '‚öΩ What does he have?' },
    { words: ['The', 'dog', 'ran', 'fast.'],    hint: 'üêï How did the dog run?' },
    { words: ['I', 'love', 'my', 'mum.'],       hint: 'üíõ Who do you love?' },
    { words: ['We', 'play', 'and', 'laugh.'],   hint: 'üòÑ What do we do?' },
    { words: ['The', 'fish', 'swims.'],         hint: 'üêü What does the fish do?' },
  ],
  7: [
    { words: ['The', 'monkey', 'climbed', 'the', 'tree.'],         hint: 'üêí Where did the monkey go?' },
    { words: ['She', 'found', 'a', 'golden', 'treasure.'],          hint: 'üí∞ What did she find?' },
    { words: ['The', 'explorer', 'crossed', 'the', 'river.'],       hint: 'üåä What did the explorer do?' },
    { words: ['A', 'parrot', 'sat', 'on', 'my', 'shoulder.'],       hint: 'ü¶ú Where did the parrot sit?' },
    { words: ['Lions', 'roar', 'loudly', 'in', 'the', 'jungle.'],   hint: 'ü¶Å What do lions do?' },
    { words: ['He', 'packed', 'his', 'bag', 'for', 'adventure.'],   hint: 'üéí What did he pack?' },
    { words: ['The', 'butterflies', 'dance', 'in', 'the', 'sun.'],  hint: 'ü¶ã What do butterflies do?' },
    { words: ['She', 'heard', 'a', 'strange', 'jungle', 'sound.'],  hint: 'üëÇ What did she hear?' },
    { words: ['The', 'vines', 'hang', 'from', 'tall', 'trees.'],    hint: 'üåø Where do vines hang?' },
    { words: ['We', 'discovered', 'a', 'hidden', 'waterfall.'],     hint: 'üíß What did we discover?' },
  ],
  9: [
    { words: ['The', 'brave', 'explorer', 'discovered', 'a', 'hidden', 'temple.'],             hint: 'üèõÔ∏è What did the explorer find?' },
    { words: ['Suddenly,', 'a', 'colourful', 'parrot', 'swooped', 'down', 'from', 'above.'],   hint: 'ü¶ú What happened suddenly?' },
    { words: ['The', 'ancient', 'map', 'led', 'them', 'deep', 'into', 'the', 'jungle.'],       hint: 'üó∫Ô∏è Where did the map lead?' },
    { words: ['She', 'carefully', 'stepped', 'over', 'the', 'sleeping', 'crocodile.'],         hint: 'üêä What did she step over?' },
    { words: ['After', 'hours', 'of', 'hiking,', 'they', 'found', 'a', 'golden', 'river.'],    hint: 'üèÜ What did they find?' },
    { words: ['The', 'tribe', 'welcomed', 'the', 'explorers', 'with', 'a', 'feast.'],          hint: 'üéâ How were the explorers welcomed?' },
    { words: ['Without', 'warning,', 'the', 'ground', 'began', 'to', 'shake', 'violently.'],   hint: 'üò± What happened without warning?' },
    { words: ['They', 'used', 'a', 'rope', 'to', 'cross', 'the', 'deep', 'ravine.'],           hint: 'ü™¢ How did they cross?' },
    { words: ['The', 'mysterious', 'flower', 'glowed', 'brightly', 'in', 'the', 'dark.'],      hint: 'üå∏ What did the flower do?' },
    { words: ['At', 'last,', 'the', 'treasure', 'chest', 'was', 'finally', 'opened.'],         hint: 'üí∞ What happened at last?' },
  ]
};

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ
let selectedAge   = null;
let score         = 0;
let lives         = 3;
let sentencesDone = 0;
let gameRunning   = false;
let currentSentence   = [];
let builtSoFar        = [];
let nextWordIndex     = 0;
let sentenceQueue     = [];
let sentenceIndex     = 0;
const SENTENCES_PER_GAME = 8;

// ‚îÄ‚îÄ AMBIENT ‚îÄ‚îÄ
function createJungleAmbience() {
  const bg = document.getElementById('jungleBg');
  // Vines
  for (let i = 0; i < 6; i++) {
    const v = document.createElement('div');
    v.className = 'vine';
    const h = Math.random() * 40 + 20;
    v.style.cssText = `
      left:${Math.random()*100}%;
      top:0; height:${h}%;
      animation-duration:${Math.random()*3+3}s;
      animation-delay:${Math.random()*2}s;
      opacity:${Math.random()*0.3+0.3};
    `;
    bg.appendChild(v);
  }
  // Fireflies
  for (let i = 0; i < 14; i++) {
    const f = document.createElement('div');
    f.className = 'firefly';
    const fx = (Math.random()-0.5)*120;
    const fy = -(Math.random()*150+50);
    f.style.cssText = `
      left:${Math.random()*100}%;
      top:${Math.random()*80+10}%;
      --fx:${fx}px; --fy:${fy}px;
      animation-duration:${Math.random()*4+3}s;
      animation-delay:${Math.random()*5}s;
    `;
    bg.appendChild(f);
  }
}

// ‚îÄ‚îÄ AGE SELECT ‚îÄ‚îÄ
function selectAge(age) {
  selectedAge = age;
  document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('selected'));
  document.querySelector(`.age-btn[data-age="${age}"]`).classList.add('selected');
  document.getElementById('startBtn').classList.add('ready');
}

// ‚îÄ‚îÄ COUNTDOWN ‚îÄ‚îÄ
function startCountdown() {
  if (!selectedAge || gameRunning) return;
  document.getElementById('startScreen').classList.add('hidden');
  document.getElementById('backLink').style.display = 'none';

  const el     = document.getElementById('countdown');
  const numEl  = document.getElementById('countdownNum');
  el.classList.remove('hidden');
  let count = 3;
  numEl.textContent = count;

  const tick = setInterval(() => {
    count--;
    if (count <= 0) {
      clearInterval(tick);
      numEl.textContent = 'üåø';
      setTimeout(() => { el.classList.add('hidden'); startGame(); }, 600);
    } else {
      numEl.style.animation = 'none';
      numEl.offsetHeight;
      numEl.style.animation = 'countPop 0.8s ease-out';
      numEl.textContent = count;
    }
  }, 900);
}

// ‚îÄ‚îÄ GAME START ‚îÄ‚îÄ
function startGame() {
  if (gameRunning) return;
  gameRunning   = true;
  score         = 0;
  lives         = 3;
  sentencesDone = 0;
  sentenceIndex = 0;

  // Shuffle sentences
  const pool = [...sentences[selectedAge]];
  for (let i = pool.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [pool[i], pool[j]] = [pool[j], pool[i]];
  }
  sentenceQueue = pool.slice(0, SENTENCES_PER_GAME);

  updateHUD();
  buildProgressDots();

  document.getElementById('hud').classList.remove('hidden');
  document.getElementById('gameArea').classList.remove('hidden');

  loadSentence();
}

// ‚îÄ‚îÄ PROGRESS DOTS ‚îÄ‚îÄ
function buildProgressDots() {
  const el = document.getElementById('progressDots');
  el.innerHTML = '';
  for (let i = 0; i < SENTENCES_PER_GAME; i++) {
    const d = document.createElement('div');
    d.className = 'dot' + (i === 0 ? ' current' : '');
    d.id = `dot-${i}`;
    el.appendChild(d);
  }
}

function updateProgressDots() {
  for (let i = 0; i < SENTENCES_PER_GAME; i++) {
    const d = document.getElementById(`dot-${i}`);
    if (!d) continue;
    d.className = 'dot';
    if (i < sentenceIndex) d.classList.add('done');
    else if (i === sentenceIndex) d.classList.add('current');
  }
}

// ‚îÄ‚îÄ LOAD SENTENCE ‚îÄ‚îÄ
function loadSentence() {
  if (sentenceIndex >= sentenceQueue.length) { endGame(); return; }

  const s = sentenceQueue[sentenceIndex];
  currentSentence = s.words;
  builtSoFar      = [];
  nextWordIndex   = 0;

  // Hint
  document.getElementById('hintArea').textContent = s.hint;

  // Clear build zone
  const bz = document.getElementById('buildZone');
  bz.innerHTML = '';

  // Shuffle words for pool
  const shuffled = [...currentSentence].sort(() => Math.random() - 0.5);
  // Make sure it's actually shuffled (not in order)
  let attempts = 0;
  while (shuffled.join('') === currentSentence.join('') && attempts < 20) {
    shuffled.sort(() => Math.random() - 0.5);
    attempts++;
  }

  // Render word tiles
  const pool = document.getElementById('wordPool');
  pool.innerHTML = '';
  shuffled.forEach((word, i) => {
    const tile = document.createElement('div');
    tile.className = 'word-tile';
    tile.textContent = word;
    tile.dataset.word = word;
    tile.dataset.idx  = i;
    tile.addEventListener('click', () => onWordTap(tile, word));
    pool.appendChild(tile);
  });

  updateProgressDots();
  setSpeech('');
}

// ‚îÄ‚îÄ WORD TAP ‚îÄ‚îÄ
function onWordTap(tile, word) {
  if (!gameRunning) return;
  const expected = currentSentence[nextWordIndex];

  if (word === expected) {
    // Correct
    tile.classList.add('used');
    builtSoFar.push(word);
    nextWordIndex++;
    addBuiltWord(word, true);
    playSound('tap');

    if (nextWordIndex === currentSentence.length) {
      // Sentence complete!
      setTimeout(() => completeSentence(), 300);
    }
  } else {
    // Wrong tap
    lives--;
    updateHUD();
    tile.style.animation = 'none';
    tile.offsetHeight;
    tile.style.animation = 'wrongShake 0.4s ease-out';
    tile.style.borderColor = 'var(--coral)';
    setTimeout(() => { tile.style.borderColor = ''; tile.style.animation = ''; }, 500);
    document.getElementById('character').classList.remove('ouch');
    void document.getElementById('character').offsetWidth;
    document.getElementById('character').classList.add('ouch');
    flashScreen('#FF6B6B');
    playSound('wrong');
    setSpeech(getOuchPhrase(), 1500);

    if (lives <= 0) { setTimeout(() => endGame(), 600); }
  }
}

function addBuiltWord(word, correct) {
  const bz = document.getElementById('buildZone');
  const el = document.createElement('div');
  el.className = 'built-word';
  el.textContent = word;
  bz.appendChild(el);
}

// ‚îÄ‚îÄ SENTENCE COMPLETE ‚îÄ‚îÄ
function completeSentence() {
  score++;
  sentencesDone++;
  updateHUD();

  // Flash all built words green
  document.querySelectorAll('.built-word').forEach(w => w.classList.add('correct-flash'));

  // Character dance
  const char = document.getElementById('character');
  char.classList.remove('dance');
  void char.offsetWidth;
  char.classList.add('dance');
  setSpeech(getCelebPhrase(), 2000);

  flashScreen('#4CAF50');
  spawnConfetti();
  playSound('correct');

  setTimeout(() => {
    sentenceIndex++;
    if (sentenceIndex >= sentenceQueue.length || sentenceIndex >= SENTENCES_PER_GAME) {
      endGame();
    } else {
      loadSentence();
    }
  }, 2000);
}

// ‚îÄ‚îÄ PHRASES ‚îÄ‚îÄ
function getCelebPhrase() {
  const p = ['Amazing! üéâ', 'You got it! ‚≠ê', 'Brilliant! üèÜ', 'Nailed it! üåü', 'Superb! ü¶Å', 'Roarsome! üêØ'];
  return p[Math.floor(Math.random()*p.length)];
}
function getOuchPhrase() {
  const p = ['Oops! Try again!', 'Not quite! üôà', 'Almost! üêí', 'Keep going! üí™', 'Whoops! üåø'];
  return p[Math.floor(Math.random()*p.length)];
}

function setSpeech(text, duration) {
  const el = document.getElementById('speechBubble');
  el.textContent = text;
  if (text) {
    el.classList.add('show');
    if (duration) setTimeout(() => el.classList.remove('show'), duration);
  } else {
    el.classList.remove('show');
  }
}

// ‚îÄ‚îÄ HUD ‚îÄ‚îÄ
function updateHUD() {
  document.getElementById('scoreVal').textContent = score;
  document.getElementById('sentenceVal').textContent = sentencesDone;
  // Lives
  for (let i = 1; i <= 3; i++) {
    const h = document.getElementById(`h${i}`);
    if (i <= lives) h.classList.remove('lost');
    else            h.classList.add('lost');
  }
}

// ‚îÄ‚îÄ VISUAL FX ‚îÄ‚îÄ
function flashScreen(color) {
  const f = document.createElement('div');
  f.className = 'flash-overlay';
  f.style.background = color;
  document.body.appendChild(f);
  setTimeout(() => f.remove(), 350);
}

function spawnConfetti() {
  const colors = ['#FFD54F','#4CAF50','#FF6B6B','#81D4FA','#CE93D8','#FFCC02'];
  const cx = window.innerWidth / 2, cy = window.innerHeight * 0.4;
  for (let i = 0; i < 28; i++) {
    const el = document.createElement('div');
    el.className = 'confetti-piece';
    const angle = Math.random() * Math.PI * 2;
    const dist  = Math.random() * 120 + 30;
    el.style.cssText = `
      left:${cx + Math.cos(angle)*dist}px;
      top:${cy + Math.sin(angle)*dist - 40}px;
      background:${colors[Math.floor(Math.random()*colors.length)]};
      width:${Math.random()*10+5}px; height:${Math.random()*10+5}px;
      border-radius:${Math.random()<0.5?'50%':'2px'};
      animation-duration:${Math.random()*0.6+0.5}s;
    `;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 1100);
  }
}

function showFeedback(text, color) {
  const el = document.createElement('div');
  el.className = 'feedback-pop';
  el.textContent = text;
  el.style.cssText = `left:50%; top:40%; transform:translateX(-50%); color:${color};`;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 900);
}

// ‚îÄ‚îÄ SOUNDS ‚îÄ‚îÄ
let audioCtx = null;
function getAudio() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  return audioCtx;
}
function playSound(type) {
  try {
    const ac   = getAudio();
    const osc  = ac.createOscillator();
    const gain = ac.createGain();
    osc.connect(gain); gain.connect(ac.destination);
    if (type === 'tap') {
      osc.frequency.setValueAtTime(440, ac.currentTime);
      gain.gain.setValueAtTime(0.08, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + 0.15);
      osc.start(ac.currentTime); osc.stop(ac.currentTime + 0.15);
    } else if (type === 'correct') {
      osc.frequency.setValueAtTime(523, ac.currentTime);
      osc.frequency.setValueAtTime(659, ac.currentTime + 0.1);
      osc.frequency.setValueAtTime(784, ac.currentTime + 0.2);
      gain.gain.setValueAtTime(0.15, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + 0.5);
      osc.start(ac.currentTime); osc.stop(ac.currentTime + 0.5);
    } else {
      osc.type = 'sawtooth';
      osc.frequency.setValueAtTime(200, ac.currentTime);
      osc.frequency.setValueAtTime(140, ac.currentTime + 0.12);
      gain.gain.setValueAtTime(0.1, ac.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ac.currentTime + 0.25);
      osc.start(ac.currentTime); osc.stop(ac.currentTime + 0.25);
    }
  } catch(e) {}
}

// ‚îÄ‚îÄ END GAME ‚îÄ‚îÄ
function endGame() {
  gameRunning = false;
  document.getElementById('hud').classList.add('hidden');
  document.getElementById('gameArea').classList.add('hidden');

  let rating, title, message;
  if (score === 0) {
    rating = 'üåø'; title = 'Keep Exploring!';
    message = "The jungle is full of surprises ‚Äî try again!";
  } else if (score <= 2) {
    rating = '‚≠ê'; title = 'Good Try!';
    message = 'Nice exploring! Can you build more sentences next time?';
  } else if (score <= 4) {
    rating = '‚≠ê‚≠ê'; title = 'Great Explorer!';
    message = 'The jungle is yours! Keep practising to reach the top!';
  } else if (score <= 6) {
    rating = '‚≠ê‚≠ê‚≠ê'; title = 'Jungle Master!';
    message = 'Incredible! You\'re a true word explorer! ü¶Å';
  } else {
    rating = 'üèÜ‚ú®'; title = 'LEGEND OF THE JUNGLE!';
    message = 'Perfect run! The jungle bows before you! üåøü¶Åüåø';
    spawnConfetti();
    setTimeout(spawnConfetti, 400);
    setTimeout(spawnConfetti, 800);
  }

  document.getElementById('endRating').textContent  = rating;
  document.getElementById('endTitle').textContent    = title;
  document.getElementById('endScoreNum').textContent = score;
  document.getElementById('endScoreSub').textContent = `out of ${Math.min(sentenceIndex, SENTENCES_PER_GAME)} sentences`;
  document.getElementById('endMessage').textContent  = message;
  document.getElementById('endScreen').classList.remove('hidden');
  document.getElementById('backLink').style.display  = 'block';
}

function playAgain() {
  document.getElementById('endScreen').classList.add('hidden');
  document.getElementById('backLink').style.display = 'none';
  gameRunning = false;
  startCountdown();
}

function changeLevel() {
  document.getElementById('endScreen').classList.add('hidden');
  document.getElementById('startScreen').classList.remove('hidden');
  document.getElementById('backLink').style.display = 'none';
  document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('selected'));
  document.getElementById('startBtn').classList.remove('ready');
  selectedAge = null;
  gameRunning = false;
}

function hudBack() {
  gameRunning = false;
  document.getElementById('hud').classList.add('hidden');
  document.getElementById('gameArea').classList.add('hidden');
  changeLevel();
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
createJungleAmbience();
document.getElementById('backLink').style.display = 'block';
</script>
</body>
</html>
