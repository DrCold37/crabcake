<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Your Avatar â€” Crabcake.kids</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
:root {
  --bg:#1a2744; --panel:#243058; --card:#2e3d6e;
  --border:rgba(255,255,255,.12); --accent:#ffd700; --teal:#1abc9c;
  --text:#eef2ff; --muted:#8899cc;
  --font-h:'Fredoka One',cursive; --font-b:'Nunito',sans-serif;
}
body {
  background:var(--bg); font-family:var(--font-b); color:var(--text);
  min-height:100vh;
  background-image:
    radial-gradient(ellipse at 20% 10%,rgba(255,215,0,.06),transparent 50%),
    radial-gradient(ellipse at 80% 90%,rgba(26,188,156,.07),transparent 50%);
}
/* HEADER */
header {
  display:flex; align-items:center; justify-content:space-between;
  padding:14px 24px; border-bottom:1px solid var(--border);
  background:rgba(0,0,0,.25); backdrop-filter:blur(8px);
  position:sticky; top:0; z-index:100;
}
.logo { font-family:var(--font-h); font-size:1.4rem; color:var(--accent); text-decoration:none; }
.logo span { color:#ff6b9d; }
.back-btn {
  display:flex; align-items:center; gap:6px;
  background:var(--card); border:1px solid var(--border);
  border-radius:12px; padding:7px 14px;
  color:var(--text); font-family:var(--font-b); font-weight:700; font-size:.82rem;
  cursor:pointer; text-decoration:none; transition:background .2s, transform .1s;
}
.back-btn:hover { background:#3a4d80; transform:translateY(-1px); }
/* LAYOUT */
.page {
  display:grid; grid-template-columns:1fr 320px;
  gap:20px; max-width:1060px; margin:0 auto; padding:22px 18px 60px;
}
@media(max-width:780px){ .page{grid-template-columns:1fr} .preview-col{order:-1} }
/* PREVIEW */
.preview-col {
  display:flex; flex-direction:column; align-items:center; gap:16px;
  position:sticky; top:76px; align-self:start;
}
.preview-stage {
  background:linear-gradient(160deg,#2e3d6e,#1a2744);
  border:2px solid var(--border); border-radius:26px;
  width:100%; max-width:300px; padding:28px 18px 22px;
  display:flex; flex-direction:column; align-items:center; gap:12px;
  box-shadow:0 8px 32px rgba(0,0,0,.4); position:relative; overflow:hidden;
}
.preview-stage::before {
  content:''; position:absolute; inset:0;
  background:radial-gradient(ellipse at 50% 0%,rgba(255,215,0,.08),transparent 60%);
  pointer-events:none;
}
.preview-lbl { font-family:var(--font-h); font-size:1rem; color:var(--accent); }
#avatar-preview { filter:drop-shadow(0 8px 16px rgba(0,0,0,.45)); transition:transform .3s cubic-bezier(.34,1.56,.64,1); }
#avatar-preview:hover { transform:scale(1.05) translateY(-4px); }
#pet-preview { filter:drop-shadow(0 5px 10px rgba(0,0,0,.35)); transition:transform .3s cubic-bezier(.34,1.56,.64,1); }
#pet-preview:hover { transform:scale(1.07) translateY(-3px); }
.preview-sub { font-size:.72rem; color:var(--muted); text-transform:uppercase; letter-spacing:1px; }
.save-btn {
  width:100%; max-width:300px;
  background:linear-gradient(135deg,#ffd700,#ffaa00);
  color:#1a1a00; font-family:var(--font-h); font-size:1.05rem;
  border:none; border-radius:14px; padding:13px;
  cursor:pointer; box-shadow:0 4px 20px rgba(255,215,0,.3);
  transition:transform .15s, box-shadow .15s;
}
.save-btn:hover  { transform:translateY(-2px); box-shadow:0 8px 28px rgba(255,215,0,.45); }
.save-btn:active { transform:translateY(0); }
.save-ok { font-size:.8rem; color:var(--teal); font-weight:700; opacity:0; transition:opacity .4s; text-align:center; height:18px; }
.save-ok.show { opacity:1; }
/* HUD DEMO */
.hud-demo {
  width:100%; max-width:300px;
  background:rgba(0,0,0,.3); border:1px solid var(--border);
  border-radius:14px; padding:12px 14px;
}
.hud-demo h4 { font-family:var(--font-h); font-size:.8rem; color:var(--muted); margin-bottom:8px; }
.hud-portrait {
  display:inline-flex; align-items:center; gap:8px;
  background:rgba(0,0,0,.5); border:2px solid rgba(255,215,0,.4);
  border-radius:13px; padding:5px 11px 5px 5px;
}
.hud-box {
  background:rgba(255,255,255,.06); border-radius:8px; overflow:hidden;
  display:flex; align-items:center; justify-content:center;
}
.hud-name { font-family:var(--font-h); font-size:.78rem; color:var(--accent); }
.hud-sub  { font-size:.58rem; color:var(--muted); }
/* OPTIONS */
.options-col { display:flex; flex-direction:column; gap:16px; }
.section {
  background:var(--panel); border:1px solid var(--border);
  border-radius:18px; padding:16px 16px 18px;
  box-shadow:0 4px 16px rgba(0,0,0,.2);
  animation:pop-in .35s ease both;
}
.section:nth-child(1){animation-delay:.04s} .section:nth-child(2){animation-delay:.08s}
.section:nth-child(3){animation-delay:.12s} .section:nth-child(4){animation-delay:.16s}
.section:nth-child(5){animation-delay:.20s} .section:nth-child(6){animation-delay:.24s}
.section:nth-child(7){animation-delay:.28s} .section:nth-child(8){animation-delay:.32s}
@keyframes pop-in { from{opacity:0;transform:scale(.9) translateY(14px)} to{opacity:1;transform:none} }
.section-head { display:flex; align-items:center; gap:9px; margin-bottom:12px; }
.section-head .icon { font-size:1.2rem; }
.section-head h3 { font-family:var(--font-h); font-size:.95rem; color:var(--accent); }
.opt-grid { display:flex; flex-wrap:wrap; gap:7px; }
/* Colour swatch */
.swatch {
  width:32px; height:32px; border-radius:50%;
  border:3px solid transparent; cursor:pointer;
  transition:transform .15s, border-color .15s;
  box-shadow:0 2px 6px rgba(0,0,0,.35);
  position:relative;
}
.swatch:hover { transform:scale(1.18); }
.swatch.active { border-color:#fff; transform:scale(1.2); }
.swatch.active::after {
  content:'âœ“'; position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  font-size:.65rem; font-weight:900; color:#fff;
  text-shadow:0 1px 3px rgba(0,0,0,.7);
}
/* Option pill */
.opt-pill {
  background:var(--card); border:2px solid var(--border);
  border-radius:11px; padding:5px 8px; cursor:pointer;
  transition:border-color .15s, background .15s, transform .12s;
  display:flex; flex-direction:column; align-items:center; gap:3px;
  font-size:.66rem; color:var(--muted); font-weight:700;
  text-transform:uppercase; letter-spacing:.5px;
}
.opt-pill:hover  { border-color:var(--accent); background:#3a4d80; transform:translateY(-2px); }
.opt-pill.active { border-color:var(--accent); background:rgba(255,215,0,.1); color:var(--accent); }
.opt-pill svg { display:block; }
/* Bounce anim */
@keyframes bounce { 0%{transform:scale(1)} 40%{transform:scale(1.07) translateY(-6px)} 70%{transform:scale(.97) translateY(2px)} 100%{transform:scale(1)} }
.bouncing { animation:bounce .38s ease; }
</style>
</head>
<body>
<header>
  <a class="logo" href="index.html">Crab<span>cake</span>.kids</a>
  <a class="back-btn" href="index.html">ğŸ  Home</a>
</header>

<div class="page">
  <!-- OPTIONS -->
  <div class="options-col">
    <div class="section"><div class="section-head"><span class="icon">ğŸ¨</span><h3>Skin Tone</h3></div><div class="opt-grid" id="skin-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸ’‡</span><h3>Hair Style</h3></div><div class="opt-grid" id="hair-style-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸŒˆ</span><h3>Hair Colour</h3></div><div class="opt-grid" id="hair-color-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸ‘ï¸</span><h3>Eye Colour</h3></div><div class="opt-grid" id="eye-color-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸ‘•</span><h3>Top</h3></div><div class="opt-grid" id="top-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸ‘–</span><h3>Bottom</h3></div><div class="opt-grid" id="bottom-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸ‘Ÿ</span><h3>Shoe Colour</h3></div><div class="opt-grid" id="shoe-grid"></div></div>
    <div class="section"><div class="section-head"><span class="icon">ğŸ¾</span><h3>Pet</h3></div><div class="opt-grid" id="pet-grid"></div></div>
  </div>

  <!-- PREVIEW -->
  <div class="preview-col">
    <div class="preview-stage">
      <div class="preview-lbl">âœ¨ Your Avatar</div>
      <svg id="avatar-preview" width="108" height="220" viewBox="0 0 88 192"></svg>
      <div class="preview-sub">Avatar</div>
      <svg id="pet-preview" width="118" height="118" viewBox="10 10 110 110"></svg>
      <div class="preview-sub">Pet</div>
    </div>
    <button class="save-btn" onclick="saveAvatar()">ğŸ’¾ Save My Avatar!</button>
    <div class="save-ok" id="save-ok">âœ… Saved! Your look travels with you.</div>
    <div class="hud-demo">
      <h4>ğŸ® How you'll look in-game</h4>
      <div class="hud-portrait">
        <div class="hud-box" style="width:46px;height:54px">
          <svg id="hud-avatar" width="40" height="48" viewBox="0 0 88 192"></svg>
        </div>
        <div class="hud-box" style="width:40px;height:40px">
          <svg id="hud-pet" width="34" height="34" viewBox="10 10 110 110"></svg>
        </div>
        <div>
          <div class="hud-name">Your Crew</div>
          <div class="hud-sub">playing now ğŸ®</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SKINS = [
  {id:'s1',l:'#fde0c0',m:'#f0c090',i:'#f0a090',name:'Fair'},
  {id:'s2',l:'#fde8d0',m:'#f0c898',i:'#f0a080',name:'Light'},
  {id:'s3',l:'#f4c07a',m:'#d4984a',i:'#c08050',name:'Medium'},
  {id:'s4',l:'#c8905a',m:'#a06030',i:'#8a4820',name:'Tan'},
  {id:'s5',l:'#9a6845',m:'#7a4828',i:'#7a3820',name:'Deep'},
];
const HAIR_COLS = [
  {id:'hc1',c:'#f0c040',name:'Blonde'},
  {id:'hc2',c:'#c0392b',name:'Red'},
  {id:'hc3',c:'#8b4513',name:'Auburn'},
  {id:'hc4',c:'#6b3a00',name:'Brown'},
  {id:'hc5',c:'#1a1a1a',name:'Black'},
  {id:'hc6',c:'#e0e0e0',name:'Silver'},
  {id:'hc7',c:'#9b59b6',name:'Purple'},
  {id:'hc8',c:'#1abc9c',name:'Teal'},
];
const EYE_COLS = [
  {id:'ec1',c:'#2980b9',name:'Blue'},
  {id:'ec2',c:'#27ae60',name:'Green'},
  {id:'ec3',c:'#7b5500',name:'Brown'},
  {id:'ec4',c:'#1a1a2e',name:'Dark'},
  {id:'ec5',c:'#2eaa88',name:'Teal'},
  {id:'ec6',c:'#8e44ad',name:'Violet'},
];
const SHOE_COLS = [
  {id:'sh1',c:'#2a2a2a',name:'Black'},
  {id:'sh2',c:'#f0f0f0',name:'White'},
  {id:'sh3',c:'#e74c3c',name:'Red'},
  {id:'sh4',c:'#2471a3',name:'Blue'},
  {id:'sh5',c:'#c8a060',name:'Tan'},
  {id:'sh6',c:'#27ae60',name:'Green'},
];
const HAIR_STYLES = [
  {id:'hs1',name:'Short'},
  {id:'hs2',name:'Wavy'},
  {id:'hs3',name:'Straight'},
  {id:'hs4',name:'Bun'},
  {id:'hs5',name:'Curly'},
  {id:'hs6',name:'Pigtails'},
];
const TOPS = [
  {id:'tp1',name:'Red Tee'},
  {id:'tp2',name:'Pink Polo'},
  {id:'tp3',name:'Purple'},
  {id:'tp4',name:'Yellow'},
  {id:'tp5',name:'Raglan'},
  {id:'tp6',name:'Hoodie'},
];
const BOTTOMS = [
  {id:'bt1',name:'Jeans'},
  {id:'bt2',name:'Shorts'},
  {id:'bt3',name:'Skirt'},
  {id:'bt4',name:'Joggers'},
];
const PETS = [
  {id:'pt0',name:'None'},
  {id:'pt1',name:'Golden'},
  {id:'pt2',name:'Brown Dog'},
  {id:'pt3',name:'Husky'},
  {id:'pt4',name:'Grey Cat'},
  {id:'pt5',name:'Tabby'},
  {id:'pt6',name:'Black Cat'},
];

/* â”€â”€ Default state â”€â”€ */
let state = {skin:'s2',hairStyle:'hs1',hairColor:'hc5',eyeColor:'ec1',top:'tp1',bottom:'bt1',shoe:'sh1',pet:'pt1'};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COLOUR UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function h2r(h){const r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(h);return r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[80,80,80];}
function r2h(r,g,b){return '#'+[r,g,b].map(x=>Math.max(0,Math.min(255,Math.round(x))).toString(16).padStart(2,'0')).join('');}
function dk(h,p){const[r,g,b]=h2r(h),f=1-p/100;return r2h(r*f,g*f,b*f);}
function lt(h,p){const[r,g,b]=h2r(h),f=p/100;return r2h(r+(255-r)*f,g+(255-g)*f,b+(255-b)*f);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AVATAR SVG BUILDER
   ViewBox: 0 0 88 192
   Head center: cx44 cy40 r24
   Neck: y60â€“y70
   Top: y68â€“y116 (hem at y116)
   Waistband: y112â€“y119 (overlaps top)
   Legs/bottom: y116â€“y177
   Shoes: y180â€“y186
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildAvatar(s) {
  const skin  = SKINS.find(x=>x.id===s.skin)||SKINS[1];
  const hcol  = HAIR_COLS.find(x=>x.id===s.hairColor)||HAIR_COLS[4];
  const ecol  = EYE_COLS.find(x=>x.id===s.eyeColor)||EYE_COLS[0];
  const shcol = SHOE_COLS.find(x=>x.id===s.shoe)||SHOE_COLS[0];
  const sid   = s.skin;
  const hc    = hcol.c;
  const ec    = ecol.c;
  const sc    = shcol.c;

  const skinGrad = `<defs>
    <radialGradient id="sg${sid}" cx="50%" cy="35%" r="65%">
      <stop offset="0%" stop-color="${skin.l}"/>
      <stop offset="100%" stop-color="${skin.m}"/>
    </radialGradient>
    <radialGradient id="ck${sid}" cx="50%" cy="50%" r="50%">
      <stop offset="0%" stop-color="#ff9090" stop-opacity=".5"/>
      <stop offset="100%" stop-color="#ff9090" stop-opacity="0"/>
    </radialGradient>
  </defs>`;

  const SK = `url(#sg${sid})`;

  return skinGrad + `
  <!-- shadow -->
  <ellipse cx="44" cy="190" rx="21" ry="4" fill="rgba(0,0,0,.2)"/>
  <!-- SHOES -->
  ${shoes(sc)}
  <!-- BOTTOM -->
  ${bottom(s.bottom, SK, skin)}
  <!-- TOP -->
  ${top(s.top)}
  <!-- ARMS -->
  ${arms(s.top, SK)}
  <!-- NECK -->
  <rect x="38" y="60" width="12" height="12" rx="5" fill="${SK}"/>
  <!-- HEAD base -->
  <circle cx="44" cy="40" r="25" fill="${SK}"/>
  <!-- HAIR back -->
  ${hairBack(s.hairStyle, hc)}
  <!-- HEAD front -->
  <circle cx="44" cy="40" r="22" fill="${SK}"/>
  <!-- HAIR front -->
  ${hairFront(s.hairStyle, hc)}
  <!-- EARS -->
  <circle cx="19" cy="42" r="6.5" fill="${SK}"/>
  <circle cx="69" cy="42" r="6.5" fill="${SK}"/>
  <circle cx="19" cy="42" r="3" fill="${skin.i}" opacity=".45"/>
  <circle cx="69" cy="42" r="3" fill="${skin.i}" opacity=".45"/>
  <!-- EYES -->
  ${eyes(ec, skin)}
  <!-- NOSE -->
  <path d="M 41.5 51 Q 44 54 46.5 51" stroke="${dk(skin.m,22)}" stroke-width="1.4" fill="none" stroke-linecap="round"/>
  <!-- MOUTH -->
  <path d="M 38 57 Q 44 63 50 57" stroke="${dk(skin.m,30)}" stroke-width="1.8" fill="none" stroke-linecap="round"/>
  <ellipse cx="44" cy="59.5" rx="4" ry="1.5" fill="#ff9090" opacity=".3"/>
  <!-- CHEEKS -->
  <circle cx="27" cy="49" r="8" fill="url(#ck${sid})"/>
  <circle cx="61" cy="49" r="8" fill="url(#ck${sid})"/>`;
}

/* â”€â”€ SHOES â”€â”€ */
function shoes(c) {
  return `
  <ellipse cx="33" cy="183" rx="12" ry="5.5" fill="${c}"/>
  <ellipse cx="55" cy="183" rx="12" ry="5.5" fill="${c}"/>
  <ellipse cx="33" cy="186" rx="12" ry="3"   fill="${dk(c,20)}" opacity=".7"/>
  <ellipse cx="55" cy="186" rx="12" ry="3"   fill="${dk(c,20)}" opacity=".7"/>
  <ellipse cx="30" cy="181" rx="5.5" ry="2"  fill="${lt(c,35)}" opacity=".35"/>
  <ellipse cx="52" cy="181" rx="5.5" ry="2"  fill="${lt(c,35)}" opacity=".35"/>`;
}

/* â”€â”€ BOTTOM â”€â”€ */
function bottom(id, SK, skin) {
  const configs = {
    bt1:{lf:'#2c4a6e',ld:'rgba(0,0,0,.09)',wb:'#1a3050',
      extra:`<path d="M 38 116 Q 44 122 50 116" stroke="#3d6088" stroke-width="2" fill="none"/>
             <rect x="22" y="112" width="44" height="7" rx="2" fill="#1a3050"/>
             <rect x="38" y="113" width="12" height="5" rx="1" fill="#9a7850"/>
             <rect x="40" y="114" width="8" height="3" rx="1" fill="#c8a060"/>
             <rect x="30" y="111" width="3" height="9" rx="1" fill="#1a3050"/>
             <rect x="54" y="111" width="3" height="9" rx="1" fill="#1a3050"/>
             <path d="M 25 127 Q 26 122 32 122 L 32 134 Q 26 136 25 132 Z" fill="none" stroke="rgba(255,255,255,.18)" stroke-width="1"/>
             <rect x="25" y="170" width="14" height="5" rx="2" fill="#3d6088"/>
             <rect x="49" y="170" width="14" height="5" rx="2" fill="#3d6088"/>`,
      skirt:false},
    bt2:{lf:'#6b7c2e',ld:'rgba(0,0,0,.09)',wb:'#4f5c20',
      extra:`<line x1="44" y1="112" x2="44" y2="155" stroke="#4f5c20" stroke-width="2"/>
             <rect x="22" y="112" width="44" height="7" rx="2" fill="#4f5c20"/>
             <rect x="30" y="111" width="3" height="9" rx="1" fill="#3a4418"/>
             <rect x="54" y="111" width="3" height="9" rx="1" fill="#3a4418"/>
             <path d="M 24 122 Q 25 118 31 118 L 31 130 Q 25 132 24 128 Z" fill="rgba(255,255,255,.1)" stroke="rgba(255,255,255,.18)" stroke-width="1"/>
             <path d="M 22 150 Q 44 156 66 150" stroke="#4f5c20" stroke-width="2" fill="none"/>`,
      skirt:false},
    bt3:{lf:null,ld:null,wb:'#1a2530',
      extra:`<path d="M 19 114 L 17 152 Q 29 160 44 160 Q 59 160 71 152 L 69 114 Z" fill="#2c3e50"/>
             <line x1="26" y1="114" x2="24" y2="159" stroke="#3d5166" stroke-width="1.2" opacity=".65"/>
             <line x1="33" y1="114" x2="32" y2="161" stroke="#3d5166" stroke-width="1.2" opacity=".65"/>
             <line x1="40" y1="114" x2="40" y2="161" stroke="#3d5166" stroke-width="1.2" opacity=".65"/>
             <line x1="48" y1="114" x2="48" y2="161" stroke="#3d5166" stroke-width="1.2" opacity=".65"/>
             <line x1="55" y1="114" x2="56" y2="161" stroke="#3d5166" stroke-width="1.2" opacity=".65"/>
             <line x1="62" y1="114" x2="64" y2="159" stroke="#3d5166" stroke-width="1.2" opacity=".65"/>
             <path d="M 18 150 Q 44 156 70 150" stroke="#3d5166" stroke-width="2" fill="none"/>
             <rect x="22" y="112" width="44" height="7" rx="2" fill="#1a2530"/>`,
      skirt:true},
    bt4:{lf:'#252525',ld:'rgba(255,255,255,.03)',wb:'#1a1a1a',
      extra:`<path d="M 38 112 Q 44 120 50 112" stroke="#444" stroke-width="2" fill="none"/>
             <rect x="22" y="108" width="44" height="8" rx="3" fill="#1a1a1a"/>
             <line x1="38" y1="112" x2="44" y2="115" stroke="#555" stroke-width="1.5" stroke-linecap="round"/>
             <line x1="50" y1="112" x2="44" y2="115" stroke="#555" stroke-width="1.5" stroke-linecap="round"/>
             <line x1="26" y1="114" x2="24" y2="175" stroke="white" stroke-width="1.5" opacity=".1"/>
             <line x1="62" y1="114" x2="63" y2="175" stroke="white" stroke-width="1.5" opacity=".1"/>
             <rect x="25" y="169" width="14" height="7" rx="3" fill="#1a1a1a"/>
             <rect x="49" y="169" width="14" height="7" rx="3" fill="#1a1a1a"/>`,
      skirt:false},
  };
  const b = configs[id]||configs.bt1;
  let out = '';
  if (b.skirt) {
    // Skin legs visible below skirt
    out += `<path d="M 29 152 L 28 177 Q 35 185 40 177 L 39 152 Z" fill="${SK}"/>
            <path d="M 49 152 L 48 177 Q 55 185 60 177 L 59 152 Z" fill="${SK}"/>`;
  } else {
    // Clothed legs
    out += `<path d="M 27 116 L 25 177 Q 33 186 40 177 L 38 116 Z" fill="${b.lf}"/>
            <path d="M 27 116 L 25 177 Q 29 182 31 177 L 30 116 Z" fill="${b.ld}"/>
            <path d="M 50 116 L 48 177 Q 56 186 62 177 L 60 116 Z" fill="${b.lf}"/>
            <path d="M 50 116 L 48 177 Q 52 182 54 177 L 53 116 Z" fill="${b.ld}"/>`;
  }
  out += b.extra;
  return out;
}

/* â”€â”€ TOP â”€â”€ */
function top(id) {
  const body = `<path d="M 24 68 L 22 116 Q 33 122 44 122 Q 55 122 66 116 L 64 68 Q 56 62 44 60 Q 32 62 24 68 Z"`;
  const sideL = `<path d="M 24 68 L 22 116 Q 25 120 27 116 L 25 68 Z" fill="rgba(0,0,0,.08)"/>`;
  const sideR = `<path d="M 64 68 L 66 116 Q 63 120 61 116 L 63 68 Z" fill="rgba(0,0,0,.08)"/>`;

  const ts = {
    tp1: {f:'#e74c3c', extra:`
      <path d="M 32 68 Q 44 76 56 68" stroke="#c0392b" stroke-width="2" fill="none"/>
      <path d="M 23 114 Q 44 120 65 114" stroke="#c0392b" stroke-width="1.5" fill="none"/>
      <path d="M 24 84 Q 44 88 64 84" stroke="rgba(255,255,255,.1)" stroke-width="2" fill="none"/>`},
    tp2: {f:'#f8b4c8', extra:`
      <path d="M 32 68 Q 44 76 56 68 Q 50 70 44 72 Q 38 70 32 68 Z" fill="#e8809c"/>
      <path d="M 34 69 Q 44 74 54 69" stroke="#e8809c" stroke-width="1.2" fill="none"/>
      <circle cx="44" cy="79" r="1.8" fill="#e8809c"/>
      <circle cx="44" cy="87" r="1.8" fill="#e8809c"/>
      <circle cx="44" cy="95" r="1.8" fill="#e8809c"/>
      <path d="M 23 114 Q 44 120 65 114" stroke="#e8809c" stroke-width="1.5" fill="none"/>`},
    tp3: {f:'#9b59b6', extra:`
      <path d="M 30 70 Q 44 78 58 70" stroke="#7d3c98" stroke-width="2" fill="none"/>
      <rect x="26" y="84" width="13" height="11" rx="3" fill="rgba(255,255,255,.12)" stroke="rgba(255,255,255,.18)" stroke-width="1"/>
      <path d="M 23 114 Q 44 120 65 114" stroke="#7d3c98" stroke-width="1.5" fill="none"/>`},
    tp4: {f:'#f1c40f', extra:`
      <path d="M 32 68 Q 44 76 56 68" stroke="#d4ac00" stroke-width="2" fill="none"/>
      <circle cx="44" cy="90" r="5" fill="#d4ac00" opacity=".45"/>
      <circle cx="44" cy="90" r="3" fill="#d4ac00" opacity=".6"/>
      <line x1="44" y1="82" x2="44" y2="80" stroke="#d4ac00" stroke-width="1.5" opacity=".5"/>
      <line x1="44" y1="98" x2="44" y2="100" stroke="#d4ac00" stroke-width="1.5" opacity=".5"/>
      <line x1="36" y1="90" x2="34" y2="90" stroke="#d4ac00" stroke-width="1.5" opacity=".5"/>
      <line x1="52" y1="90" x2="54" y2="90" stroke="#d4ac00" stroke-width="1.5" opacity=".5"/>
      <path d="M 23 114 Q 44 120 65 114" stroke="#d4ac00" stroke-width="1.5" fill="none"/>`},
    tp5: {f:'white', extra:`
      <path d="M 24 68 L 23 90 L 28 90 L 28 68 Z" fill="#2c3e50"/>
      <path d="M 64 68 L 65 90 L 60 90 L 60 68 Z" fill="#2c3e50"/>
      <path d="M 32 68 Q 44 76 56 68 Q 50 70 44 72 Q 38 70 32 68 Z" fill="#2c3e50"/>
      <path d="M 23 114 Q 44 120 65 114" stroke="#ddd" stroke-width="1.5" fill="none"/>`},
    tp6: {f:'#1abc9c', extra:`
      <path d="M 28 62 Q 44 52 60 62 Q 56 56 44 54 Q 32 56 28 62 Z" fill="#0e9a7e"/>
      <line x1="44" y1="70" x2="44" y2="116" stroke="#0e9a7e" stroke-width="2"/>
      <circle cx="44" cy="79" r="3" fill="#aaa"/>
      <path d="M 30 92 Q 44 97 58 92 L 58 105 Q 44 109 30 105 Z" fill="#0e9a7e" opacity=".65"/>
      <path d="M 30 68 Q 44 76 58 68" stroke="#0e9a7e" stroke-width="2" fill="none"/>
      <path d="M 23 114 Q 44 120 65 114" stroke="#0e9a7e" stroke-width="1.5" fill="none"/>`},
  };
  const t = ts[id]||ts.tp1;
  return `${body} fill="${t.f}"/> ${sideL} ${sideR} ${t.extra}`;
}

/* â”€â”€ ARMS â”€â”€ */
function arms(topId, SK) {
  const caps = {tp1:'#e74c3c',tp2:'#f8b4c8',tp3:'#9b59b6',tp4:'#f1c40f',tp5:'#2c3e50',tp6:'#1abc9c'};
  const cap = caps[topId]||'#e74c3c';
  return `
  <!-- Waving right arm -->
  <path d="M 64 74 Q 77 66 80 52 Q 83 41 76 35" stroke="${SK}" stroke-width="10" fill="none" stroke-linecap="round"/>
  <ellipse cx="65" cy="72" rx="7" ry="5" fill="${cap}" transform="rotate(-20 65 72)"/>
  <circle cx="76" cy="33" r="6.5" fill="${SK}"/>
  <ellipse cx="76" cy="27" rx="3.5" ry="3"   fill="${SK}"/>
  <ellipse cx="82" cy="29" rx="3"   ry="3.5" fill="${SK}"/>
  <ellipse cx="84" cy="34" rx="2.8" ry="3.5" fill="${SK}"/>
  <!-- Left arm hip -->
  <path d="M 24 74 Q 13 82 14 96 Q 15 104 22 104" stroke="${SK}" stroke-width="10" fill="none" stroke-linecap="round"/>
  <ellipse cx="23" cy="72" rx="7" ry="5" fill="${cap}" transform="rotate(20 23 72)"/>
  <circle cx="14" cy="106" r="6.5" fill="${SK}"/>`;
}

/* â”€â”€ EYES â”€â”€ */
function eyes(ec, skin) {
  return `
  <ellipse cx="36" cy="40" rx="6" ry="6.5" fill="white"/>
  <ellipse cx="52" cy="40" rx="6" ry="6.5" fill="white"/>
  <ellipse cx="36" cy="36" rx="6" ry="3.5" fill="${skin.m}" opacity=".2"/>
  <ellipse cx="52" cy="36" rx="6" ry="3.5" fill="${skin.m}" opacity=".2"/>
  <circle cx="36" cy="41" r="4.2" fill="${ec}"/>
  <circle cx="52" cy="41" r="4.2" fill="${ec}"/>
  <circle cx="36" cy="41" r="2.4" fill="#1a1a2e"/>
  <circle cx="52" cy="41" r="2.4" fill="#1a1a2e"/>
  <circle cx="37.5" cy="39.5" r="1.5" fill="white"/>
  <circle cx="53.5" cy="39.5" r="1.5" fill="white"/>
  <circle cx="35" cy="43" r=".8" fill="white" opacity=".5"/>
  <circle cx="51" cy="43" r=".8" fill="white" opacity=".5"/>
  <path d="M 30 36 Q 33 32 36 34" stroke="#1a1a2e" stroke-width="1.3" fill="none" stroke-linecap="round"/>
  <path d="M 33 34 Q 36 30 39 33" stroke="#1a1a2e" stroke-width="1.1" fill="none" stroke-linecap="round"/>
  <path d="M 46 34 Q 49 30 52 34" stroke="#1a1a2e" stroke-width="1.1" fill="none" stroke-linecap="round"/>
  <path d="M 49 36 Q 52 32 55 36" stroke="#1a1a2e" stroke-width="1.3" fill="none" stroke-linecap="round"/>
  <path d="M 30 46 Q 36 49 42 46" stroke="#1a1a2e" stroke-width=".8" fill="none" opacity=".3"/>
  <path d="M 46 46 Q 52 49 58 46" stroke="#1a1a2e" stroke-width=".8" fill="none" opacity=".3"/>`;
}

/* â”€â”€ HAIR â”€â”€ */
function hairBack(id, c) {
  const hi = lt(c,28);
  switch(id) {
    case 'hs1': return `
      <ellipse cx="44" cy="16" rx="25" ry="13" fill="${c}"/>
      <rect x="19" y="16" width="50" height="18" rx="5" fill="${c}"/>
      <rect x="17" y="20" width="9" height="14" rx="4" fill="${c}"/>
      <rect x="62" y="20" width="9" height="14" rx="4" fill="${c}"/>`;
    case 'hs2': return `
      <ellipse cx="44" cy="19" rx="26" ry="13" fill="${c}"/>
      <ellipse cx="18" cy="38" rx="10" ry="22" fill="${c}"/>
      <ellipse cx="70" cy="38" rx="10" ry="22" fill="${c}"/>
      <path d="M 13 48 Q 17 56 13 64 Q 17 72 13 78" stroke="${c}" stroke-width="9" fill="none" stroke-linecap="round"/>
      <path d="M 75 48 Q 71 56 75 64 Q 71 72 75 78" stroke="${c}" stroke-width="9" fill="none" stroke-linecap="round"/>`;
    case 'hs3': return `
      <ellipse cx="44" cy="17" rx="26" ry="13" fill="${c}"/>
      <rect x="13" y="17" width="13" height="70" rx="6" fill="${c}"/>
      <rect x="62" y="17" width="13" height="70" rx="6" fill="${c}"/>`;
    case 'hs4': return `
      <ellipse cx="44" cy="19" rx="26" ry="13" fill="${c}"/>
      <rect x="18" y="15" width="52" height="16" rx="5" fill="${c}"/>
      <rect x="16" y="21" width="9" height="14" rx="4" fill="${c}"/>
      <rect x="63" y="21" width="9" height="14" rx="4" fill="${c}"/>`;
    case 'hs5': return `
      <circle cx="44" cy="14" r="28" fill="${c}"/>
      <rect x="16" y="14" width="56" height="14" rx="4" fill="${c}"/>
      <circle cx="27" cy="14" r="18" fill="${c}"/>
      <circle cx="61" cy="14" r="18" fill="${c}"/>`;
    case 'hs6': return `
      <ellipse cx="44" cy="19" rx="26" ry="12" fill="${c}"/>
      <path d="M 20 26 Q 6 32 8 52 Q 10 62 18 64" stroke="${c}" stroke-width="13" fill="none" stroke-linecap="round"/>
      <circle cx="17" cy="66" r="8" fill="${c}"/>
      <path d="M 68 26 Q 82 32 80 52 Q 78 62 70 64" stroke="${c}" stroke-width="13" fill="none" stroke-linecap="round"/>
      <circle cx="71" cy="66" r="8" fill="${c}"/>`;
    default: return hairBack('hs1', c);
  }
}

function hairFront(id, c) {
  const hi = lt(c,28);
  const hm = dk(c,8);
  switch(id) {
    case 'hs1': return `
      <path d="M 30 14 Q 34 7 40 13" fill="${c}"/>
      <path d="M 38 10 Q 44 3 50 10" fill="${c}"/>
      <path d="M 50 12 Q 56 6 62 13" fill="${c}"/>
      <ellipse cx="40" cy="10" rx="9" ry="4" fill="${hi}" opacity=".5"/>`;
    case 'hs2': return `
      <ellipse cx="44" cy="16" rx="22" ry="9" fill="${c}"/>
      <path d="M 23 19 Q 27 29 32 23" fill="${c}"/>
      <path d="M 64 19 Q 60 29 55 23" fill="${c}"/>
      <ellipse cx="36" cy="15" rx="8" ry="3.5" fill="${hi}" opacity=".5"/>`;
    case 'hs3': return `
      <rect x="22" y="15" width="44" height="13" rx="5" fill="${c}"/>
      <ellipse cx="44" cy="15" rx="22" ry="8" fill="${c}"/>
      <ellipse cx="36" cy="13" rx="9" ry="3.5" fill="${hi}" opacity=".5"/>`;
    case 'hs4': return `
      <circle cx="44" cy="10" r="11" fill="${c}"/>
      <ellipse cx="40" cy="6" rx="5" ry="3.5" fill="${hi}" opacity=".6"/>
      <path d="M 39 8 Q 44 4 49 8 Q 46 12 42 10" stroke="${hi}" stroke-width="1.2" fill="none" opacity=".5"/>
      <ellipse cx="44" cy="21" rx="9" ry="3.5" fill="#e91e8c"/>
      <rect x="21" y="17" width="46" height="12" rx="5" fill="${c}"/>
      <ellipse cx="44" cy="17" rx="23" ry="8" fill="${c}"/>
      <ellipse cx="36" cy="15" rx="9" ry="3.5" fill="${hi}" opacity=".5"/>
      <rect x="18" y="22" width="8" height="14" rx="4" fill="${c}"/>
      <rect x="62" y="22" width="8" height="14" rx="4" fill="${c}"/>`;
    case 'hs5': return `
      <circle cx="22" cy="8" r="7" fill="${hi}" opacity=".5"/>
      <circle cx="66" cy="8" r="7" fill="${hi}" opacity=".5"/>
      <ellipse cx="27" cy="5" rx="8" ry="5" fill="${hi}" opacity=".4"/>
      <ellipse cx="61" cy="5" rx="8" ry="5" fill="${hi}" opacity=".4"/>
      <path d="M 24 28 Q 20 35 24 43" stroke="${c}" stroke-width="5" fill="none" stroke-linecap="round"/>
      <path d="M 64 28 Q 68 35 64 43" stroke="${c}" stroke-width="5" fill="none" stroke-linecap="round"/>`;
    case 'hs6': return `
      <ellipse cx="44" cy="13" rx="24" ry="9" fill="${c}"/>
      <path d="M 26 16 Q 30 27 35 21" fill="${c}"/>
      <ellipse cx="38" cy="12" rx="8" ry="3.5" fill="${hi}" opacity=".5"/>
      <circle cx="20" cy="26" r="5" fill="#e91e8c"/>
      <circle cx="68" cy="26" r="5" fill="#e91e8c"/>`;
    default: return hairFront('hs1', c);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PET SVG BUILDER (viewBox: 0 0 130 130)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildPet(id) {
  switch(id) {
    case 'pt0': return noPet();
    case 'pt1': return goldenDog();
    case 'pt2': return brownDog();
    case 'pt3': return huskyDog();
    case 'pt4': return greyCat();
    case 'pt5': return tabbyCat();
    case 'pt6': return blackCat();
    default:    return goldenDog();
  }
}

function noPet() {
  return `<text x="65" y="72" font-size="44" text-anchor="middle">ğŸš«</text>
          <text x="65" y="100" font-size="13" fill="#666" text-anchor="middle" font-family="Nunito,sans-serif" font-weight="700">No Pet</text>`;
}

function dogBase(body, ear, snout, eyeC, collar, eyeAlt) {
  const light = lt(body, 30);
  const dark  = dk(body, 15);
  return `
  <defs>
    <radialGradient id="db" cx="50%" cy="40%" r="60%">
      <stop offset="0%" stop-color="${light}"/>
      <stop offset="100%" stop-color="${body}"/>
    </radialGradient>
    <radialGradient id="ds" cx="50%" cy="50%" r="60%">
      <stop offset="0%" stop-color="${lt(snout,35)}"/>
      <stop offset="100%" stop-color="${snout}"/>
    </radialGradient>
  </defs>
  <!-- Ears floppy -->
  <ellipse cx="28" cy="52" rx="18" ry="30" fill="${ear}" transform="rotate(-12 28 52)"/>
  <ellipse cx="102" cy="52" rx="18" ry="30" fill="${ear}" transform="rotate(12 102 52)"/>
  <ellipse cx="28" cy="44" rx="9" ry="14" fill="${dk(ear,10)}" opacity=".4" transform="rotate(-12 28 44)"/>
  <ellipse cx="102" cy="44" rx="9" ry="14" fill="${dk(ear,10)}" opacity=".4" transform="rotate(12 102 44)"/>
  <!-- Head -->
  <ellipse cx="65" cy="54" rx="40" ry="38" fill="url(#db)"/>
  <!-- Forehead shine -->
  <ellipse cx="56" cy="36" rx="18" ry="10" fill="${light}" opacity=".3"/>
  <!-- Snout -->
  <ellipse cx="65" cy="70" rx="22" ry="15" fill="url(#ds)"/>
  <!-- Nose -->
  <ellipse cx="65" cy="63" rx="10" ry="7" fill="#2c1810"/>
  <ellipse cx="62" cy="61" rx="3.5" ry="2.5" fill="white" opacity=".4"/>
  <!-- Smile -->
  <path d="M 58 68 Q 65 72 72 68" stroke="#1a0a00" stroke-width="1.2" fill="none" stroke-linecap="round"/>
  <!-- Tongue -->
  <ellipse cx="65" cy="76" rx="8" ry="7" fill="#ff6b8a"/>
  <line x1="65" y1="70" x2="65" y2="81" stroke="#e05070" stroke-width="1.5"/>
  <ellipse cx="61" cy="73" rx="3" ry="4" fill="white" opacity=".2"/>
  <!-- Eyes -->
  <circle cx="46" cy="46" r="11" fill="white"/>
  <circle cx="84" cy="46" r="11" fill="white"/>
  <ellipse cx="46" cy="42" rx="11" ry="6" fill="${body}" opacity=".18"/>
  <ellipse cx="84" cy="42" rx="11" ry="6" fill="${body}" opacity=".18"/>
  <circle cx="46" cy="47" r="7.5" fill="${eyeAlt||eyeC}"/>
  <circle cx="84" cy="47" r="7.5" fill="${eyeAlt||eyeC}"/>
  <circle cx="46" cy="47" r="4.5" fill="#1a1a2e"/>
  <circle cx="84" cy="47" r="4.5" fill="#1a1a2e"/>
  <circle cx="49" cy="44" r="3" fill="white"/>
  <circle cx="87" cy="44" r="3" fill="white"/>
  <circle cx="44" cy="51" r="1.5" fill="white" opacity=".5"/>
  <circle cx="82" cy="51" r="1.5" fill="white" opacity=".5"/>
  <!-- Brows -->
  <path d="M 36 38 Q 46 33 56 38" stroke="${dark}" stroke-width="2.5" fill="none" stroke-linecap="round"/>
  <path d="M 74 38 Q 84 33 94 38" stroke="${dark}" stroke-width="2.5" fill="none" stroke-linecap="round"/>
  <!-- Collar -->
  <path d="M 27 87 Q 65 98 103 87" stroke="${collar}" stroke-width="8" fill="none" stroke-linecap="round"/>
  <circle cx="65" cy="95" r="6" fill="#f1c40f"/>
  <circle cx="65" cy="95" r="3" fill="#d4a000"/>
  <!-- Cheeks -->
  <circle cx="32" cy="64" r="10" fill="#ff9090" opacity=".18"/>
  <circle cx="98" cy="64" r="10" fill="#ff9090" opacity=".18"/>`;
}

function goldenDog()  { return dogBase('#c88030','#a06020','#e0b060','#6b3a00','#e74c3c'); }
function brownDog()   { return dogBase('#7a4820','#5a2e10','#a07050','#6b3a00','#2980b9'); }

function huskyDog() { return `
  <defs>
    <radialGradient id="hb" cx="50%" cy="40%" r="60%">
      <stop offset="0%" stop-color="#8090a0"/><stop offset="100%" stop-color="#506070"/>
    </radialGradient>
    <radialGradient id="hw" cx="50%" cy="50%" r="60%">
      <stop offset="0%" stop-color="#e8e8e8"/><stop offset="100%" stop-color="#c0c0c0"/>
    </radialGradient>
  </defs>
  <!-- Pointy ears -->
  <polygon points="28,40 16,8 46,28" fill="#506070"/>
  <polygon points="102,40 114,8 84,28" fill="#506070"/>
  <polygon points="30,36 20,12 44,28" fill="#ffbbcc"/>
  <polygon points="100,36 110,12 86,28" fill="#ffbbcc"/>
  <!-- Head -->
  <ellipse cx="65" cy="56" rx="42" ry="40" fill="url(#hb)"/>
  <!-- White face mask -->
  <ellipse cx="65" cy="65" rx="30" ry="32" fill="url(#hw)"/>
  <!-- Forehead dark patches -->
  <ellipse cx="50" cy="42" rx="13" ry="9" fill="#506070"/>
  <ellipse cx="80" cy="42" rx="13" ry="9" fill="#506070"/>
  <!-- Snout -->
  <ellipse cx="65" cy="74" rx="18" ry="12" fill="#d8d8d8"/>
  <!-- Nose -->
  <ellipse cx="65" cy="67" rx="9" ry="6.5" fill="#1a1a2e"/>
  <ellipse cx="62" cy="65" rx="3" ry="2" fill="white" opacity=".4"/>
  <path d="M 59 71 Q 65 74 71 71" stroke="#555" stroke-width="1.2" fill="none"/>
  <!-- Eyes ice blue -->
  <circle cx="46" cy="49" r="11" fill="white"/>
  <circle cx="84" cy="49" r="11" fill="white"/>
  <circle cx="46" cy="50" r="7.5" fill="#4ab8d8"/>
  <circle cx="84" cy="50" r="7.5" fill="#4ab8d8"/>
  <circle cx="46" cy="50" r="4.5" fill="#1a2a3a"/>
  <circle cx="84" cy="50" r="4.5" fill="#1a2a3a"/>
  <circle cx="49" cy="47" r="3" fill="white"/>
  <circle cx="87" cy="47" r="3" fill="white"/>
  <!-- Smile -->
  <path d="M 54 80 Q 65 90 76 80" stroke="#888" stroke-width="2" fill="none" stroke-linecap="round"/>
  <!-- Collar teal -->
  <path d="M 26 90 Q 65 102 104 90" stroke="#1abc9c" stroke-width="8" fill="none" stroke-linecap="round"/>
  <circle cx="65" cy="98" r="6" fill="#f1c40f"/>
  <circle cx="65" cy="98" r="3" fill="#d4a000"/>
  <circle cx="30" cy="64" r="9" fill="#ff9090" opacity=".14"/>
  <circle cx="100" cy="64" r="9" fill="#ff9090" opacity=".14"/>`;
}

function catBase(body, ear, inner, eyeC, collar, pupils, stripes, whiskerC) {
  const light = lt(body,30);
  const wc = whiskerC||'rgba(200,220,255,.9)';
  return `
  <defs>
    <radialGradient id="cb" cx="50%" cy="40%" r="60%">
      <stop offset="0%" stop-color="${light}"/>
      <stop offset="100%" stop-color="${body}"/>
    </radialGradient>
    <radialGradient id="ci" cx="50%" cy="50%" r="60%">
      <stop offset="0%" stop-color="${lt(inner,30)}"/>
      <stop offset="100%" stop-color="${inner}"/>
    </radialGradient>
  </defs>
  <!-- Ears -->
  <polygon points="28,36 14,6 48,26"  fill="${dk(body,12)}"/>
  <polygon points="102,36 116,6 82,26" fill="${dk(body,12)}"/>
  <polygon points="30,32 18,10 46,26" fill="${ear}"/>
  <polygon points="100,32 112,10 84,26" fill="${ear}"/>
  <!-- Head -->
  <circle cx="65" cy="62" r="44" fill="url(#cb)"/>
  <!-- Forehead shine -->
  <ellipse cx="56" cy="44" rx="18" ry="9" fill="${light}" opacity=".28"/>
  ${stripes||''}
  <!-- Inner face -->
  <ellipse cx="65" cy="74" rx="22" ry="16" fill="url(#ci)"/>
  <!-- Nose -->
  <polygon points="65,67 59,74 71,74" fill="#ffaacc"/>
  <!-- Mouth -->
  <path d="M 59 76 Q 65 82 71 76" stroke="${dk(inner,30)}" stroke-width="1.8" fill="none" stroke-linecap="round"/>
  <line x1="65" y1="74" x2="65" y2="76" stroke="${dk(inner,30)}" stroke-width="1.8"/>
  <!-- Whiskers -->
  <line x1="16" y1="69" x2="46" y2="72" stroke="${wc}" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="16" y1="75" x2="46" y2="74" stroke="${wc}" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="16" y1="81" x2="46" y2="77" stroke="${wc}" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="84" y1="72" x2="114" y2="69" stroke="${wc}" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="84" y1="74" x2="114" y2="75" stroke="${wc}" stroke-width="1.5" stroke-linecap="round"/>
  <line x1="84" y1="77" x2="114" y2="81" stroke="${wc}" stroke-width="1.5" stroke-linecap="round"/>
  <!-- Eyes -->
  <ellipse cx="46" cy="53" rx="13" ry="12" fill="white"/>
  <ellipse cx="84" cy="53" rx="13" ry="12" fill="white"/>
  <circle cx="46" cy="54" r="9" fill="${eyeC}"/>
  <circle cx="84" cy="54" r="9" fill="${eyeC}"/>
  ${pupils==='slit'
    ? `<ellipse cx="46" cy="54" rx="4" ry="8.5" fill="#1a1a2e"/>
       <ellipse cx="84" cy="54" rx="4" ry="8.5" fill="#1a1a2e"/>`
    : `<circle cx="46" cy="54" r="5" fill="#1a1a2e"/>
       <circle cx="84" cy="54" r="5" fill="#1a1a2e"/>`}
  <circle cx="50" cy="49" r="4" fill="white"/>
  <circle cx="88" cy="49" r="4" fill="white"/>
  <!-- Collar -->
  <path d="M 24 94 Q 65 106 106 94" stroke="${collar}" stroke-width="8" fill="none" stroke-linecap="round"/>
  <circle cx="65" cy="102" r="6" fill="#f1c40f"/>
  <circle cx="65" cy="102" r="3" fill="#d4a000"/>
  <!-- Cheeks -->
  <circle cx="30" cy="70" r="9" fill="#ff9090" opacity=".2"/>
  <circle cx="100" cy="70" r="9" fill="#ff9090" opacity=".2"/>`;
}

function greyCat()  {
  return catBase('#7a8f9a','#ffbbcc','#c0cdd5','#4a90c8','#9b59b6','slit',
    `<path d="M 48 34 Q 54 26 60 34" stroke="#607080" stroke-width="2.5" fill="none"/>
     <path d="M 60 30 Q 65 22 70 30" stroke="#607080" stroke-width="2.5" fill="none"/>
     <path d="M 72 34 Q 78 26 84 34" stroke="#607080" stroke-width="2.5" fill="none"/>`);
}

function tabbyCat() {
  return catBase('#d07020','#ffbbcc','#f0c080','#3498db','#e74c3c','slit',
    `<path d="M 44 28 Q 50 20 56 28" stroke="#b05010" stroke-width="3" fill="none" stroke-linecap="round"/>
     <path d="M 56 24 Q 65 16 74 24" stroke="#b05010" stroke-width="3" fill="none" stroke-linecap="round"/>
     <path d="M 74 28 Q 80 20 86 28" stroke="#b05010" stroke-width="3" fill="none" stroke-linecap="round"/>`,
    'white');
}

function blackCat() {
  return catBase('#1a1a2a','#553366','#2a2a44','#a0d000','#8b0000','slit',
    `<ellipse cx="50" cy="38" rx="20" ry="10" fill="#333344" opacity=".5"/>`,
    'rgba(255,255,255,.85)');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function render() {
  const av = buildAvatar(state);
  const pt = buildPet(state.pet);

  const ap = document.getElementById('avatar-preview');
  ap.innerHTML = av;
  ap.classList.remove('bouncing');
  void ap.offsetWidth;
  ap.classList.add('bouncing');

  document.getElementById('pet-preview').innerHTML = pt;
  document.getElementById('hud-avatar').innerHTML  = av;
  document.getElementById('hud-pet').innerHTML     = pt;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI BUILDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function swatch(c, id, label, activeId, gridId, onClick) {
  const el = document.createElement('div');
  el.className = 'swatch' + (id===activeId?' active':'');
  el.style.background = c;
  el.title = label;
  el.dataset.id = id;
  el.onclick = () => { onClick(id); syncSwatches(gridId, id); render(); };
  return el;
}

function pill(labelTxt, svgStr, id, activeId, gridId, onClick) {
  const el = document.createElement('div');
  el.className = 'opt-pill' + (id===activeId?' active':'');
  el.dataset.id = id;
  el.innerHTML = svgStr + `<span>${labelTxt}</span>`;
  el.onclick = () => { onClick(id); syncPills(gridId, id); render(); };
  return el;
}

function syncSwatches(gridId, activeId) {
  document.querySelectorAll(`#${gridId} .swatch`).forEach(el => el.classList.toggle('active', el.dataset.id===activeId));
}
function syncPills(gridId, activeId) {
  document.querySelectorAll(`#${gridId} .opt-pill`).forEach(el => el.classList.toggle('active', el.dataset.id===activeId));
}

/* Skin */
function initSkin() {
  const g = document.getElementById('skin-grid');
  SKINS.forEach(s => {
    const el = swatch(`linear-gradient(135deg,${s.l},${s.m})`, s.id, s.name, state.skin, 'skin-grid', id=>{state.skin=id;});
    g.appendChild(el);
  });
}
/* Hair colour */
function initHairColor() {
  const g = document.getElementById('hair-color-grid');
  HAIR_COLS.forEach(h => {
    const el = swatch(h.c, h.id, h.name, state.hairColor, 'hair-color-grid', id=>{state.hairColor=id;});
    g.appendChild(el);
  });
}
/* Eye colour */
function initEyeColor() {
  const g = document.getElementById('eye-color-grid');
  EYE_COLS.forEach(e => {
    const el = swatch(e.c, e.id, e.name, state.eyeColor, 'eye-color-grid', id=>{state.eyeColor=id;});
    g.appendChild(el);
  });
}
/* Shoe colour */
function initShoe() {
  const g = document.getElementById('shoe-grid');
  SHOE_COLS.forEach(s => {
    const el = swatch(s.c, s.id, s.name, state.shoe, 'shoe-grid', id=>{state.shoe=id;});
    g.appendChild(el);
  });
}
/* Hair style */
function initHairStyle() {
  const g = document.getElementById('hair-style-grid');
  HAIR_STYLES.forEach(h => {
    const svg = `<svg width="54" height="44" viewBox="10 5 68 54">
      <circle cx="44" cy="38" r="20" fill="#f5c8a0"/>
      ${hairBack(h.id,'#6b3a00')}
      <circle cx="44" cy="38" r="17" fill="#f5c8a0"/>
      ${hairFront(h.id,'#6b3a00')}
    </svg>`;
    g.appendChild(pill(h.name, svg, h.id, state.hairStyle, 'hair-style-grid', id=>{state.hairStyle=id;}));
  });
}
/* Tops */
function initTops() {
  const g = document.getElementById('top-grid');
  TOPS.forEach(t => {
    const svg = `<svg width="54" height="44" viewBox="14 60 60 62">${top(t.id)}</svg>`;
    g.appendChild(pill(t.name, svg, t.id, state.top, 'top-grid', id=>{state.top=id;}));
  });
}
/* Bottoms */
function initBottoms() {
  const g = document.getElementById('bottom-grid');
  const fakeSkin = SKINS[1];
  BOTTOMS.forEach(b => {
    const svg = `<svg width="54" height="50" viewBox="16 108 56 78">
      <defs>
        <radialGradient id="bpv" cx="50%" cy="35%" r="65%">
          <stop offset="0%" stop-color="${fakeSkin.l}"/>
          <stop offset="100%" stop-color="${fakeSkin.m}"/>
        </radialGradient>
      </defs>
      ${bottom(b.id,'url(#bpv)', fakeSkin)}
    </svg>`;
    g.appendChild(pill(b.name, svg, b.id, state.bottom, 'bottom-grid', id=>{state.bottom=id;}));
  });
}
/* Pets */
function initPets() {
  const g = document.getElementById('pet-grid');
  PETS.forEach(p => {
    const svg = `<svg width="62" height="58" viewBox="10 10 110 110">${buildPet(p.id)}</svg>`;
    g.appendChild(pill(p.name, svg, p.id, state.pet, 'pet-grid', id=>{state.pet=id;}));
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE / LOAD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveAvatar() {
  try { localStorage.setItem('crabcake_avatar', JSON.stringify(state)); } catch(e) {}
  const el = document.getElementById('save-ok');
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 3000);
}
function loadSaved() {
  try {
    const d = localStorage.getItem('crabcake_avatar');
    if (d) Object.assign(state, JSON.parse(d));
  } catch(e) {}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
loadSaved();
initSkin(); initHairStyle(); initHairColor(); initEyeColor();
initTops(); initBottoms(); initShoe(); initPets();
render();
</script>
</body>
</html>
